function GUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.diffsync=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned){var c;c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0}},{}],2:[function(a,b,c){b.exports={Client:a("./src/client"),Server:a("./src/server"),COMMANDS:a("./src/commands"),InMemoryDataAdapter:a("./src/adapter")}},{"./src/adapter":43,"./src/client":44,"./src/commands":45,"./src/server":46}],3:[function(a,b,c){var d=a("../pipe").Pipe,e=function(){};e.prototype.setResult=function(a){return this.result=a,this.hasResult=!0,this},e.prototype.exit=function(){return this.exiting=!0,this},e.prototype.switchTo=function(a,b){return"string"==typeof a||a instanceof d?this.nextPipe=a:(this.next=a,b&&(this.nextPipe=b)),this},e.prototype.push=function(a,b){return a.parent=this,"undefined"!=typeof b&&(a.childName=b),a.root=this.root||this,a.options=a.options||this.options,this.children?(this.children[this.children.length-1].next=a,this.children.push(a)):(this.children=[a],this.nextAfterChildren=this.next||null,this.next=a),a.next=this,this},c.Context=e},{"../pipe":17}],4:[function(a,b,c){var d=a("./context").Context,e=function(a,b){this.left=a,this.right=b,this.pipe="diff"};e.prototype=new d,c.DiffContext=e},{"./context":3}],5:[function(a,b,c){var d=a("./context").Context,e=function(a,b){this.left=a,this.delta=b,this.pipe="patch"};e.prototype=new d,c.PatchContext=e},{"./context":3}],6:[function(a,b,c){var d=a("./context").Context,e=function(a){this.delta=a,this.pipe="reverse"};e.prototype=new d,c.ReverseContext=e},{"./context":3}],7:[function(a,b,c){b.exports=function(a,b){var c;return"string"==typeof b&&(c=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d*))?(Z|([+\-])(\d{2}):(\d{2}))$/.exec(b))?new Date(Date.UTC(+c[1],+c[2]-1,+c[3],+c[4],+c[5],+c[6],+(c[7]||0))):b}},{}],8:[function(a,b,c){var d=a("./processor").Processor,e=a("./pipe").Pipe,f=a("./contexts/diff").DiffContext,g=a("./contexts/patch").PatchContext,h=a("./contexts/reverse").ReverseContext,i=a("./filters/trivial"),j=a("./filters/nested"),k=a("./filters/arrays"),l=a("./filters/dates"),m=a("./filters/texts"),n=function(a){this.processor=new d(a),this.processor.pipe(new e("diff").append(j.collectChildrenDiffFilter,i.diffFilter,l.diffFilter,m.diffFilter,j.objectsDiffFilter,k.diffFilter).shouldHaveResult()),this.processor.pipe(new e("patch").append(j.collectChildrenPatchFilter,k.collectChildrenPatchFilter,i.patchFilter,m.patchFilter,j.patchFilter,k.patchFilter).shouldHaveResult()),this.processor.pipe(new e("reverse").append(j.collectChildrenReverseFilter,k.collectChildrenReverseFilter,i.reverseFilter,m.reverseFilter,j.reverseFilter,k.reverseFilter).shouldHaveResult())};n.prototype.options=function(){return this.processor.options.apply(this.processor,arguments)},n.prototype.diff=function(a,b){return this.processor.process(new f(a,b))},n.prototype.patch=function(a,b){return this.processor.process(new g(a,b))},n.prototype.reverse=function(a){return this.processor.process(new h(a))},n.prototype.unpatch=function(a,b){return this.patch(a,this.reverse(b))},c.DiffPatcher=n},{"./contexts/diff":4,"./contexts/patch":5,"./contexts/reverse":6,"./filters/arrays":10,"./filters/dates":11,"./filters/nested":13,"./filters/texts":14,"./filters/trivial":15,"./pipe":17,"./processor":18}],9:[function(a,b,c){c.isBrowser="undefined"!=typeof window},{}],10:[function(a,b,c){function d(a,b,c,d){for(var e=0;c>e;e++)for(var f=a[e],g=0;d>g;g++){var h=b[g];if(f===h)return!0}}function e(a,b,c,d,e){var f=a[c],g=b[d];if(f===g)return!0;if("object"!=typeof f||"object"!=typeof g)return!1;var h=e.objectHash;if(!h)return e.matchByPosition&&c===d;var i,j;return"number"==typeof c?(e.hashCache1=e.hashCache1||[],i=e.hashCache1[c],"undefined"==typeof i&&(e.hashCache1[c]=i=h(f,c))):i=h(f),"undefined"==typeof i?!1:("number"==typeof d?(e.hashCache2=e.hashCache2||[],j=e.hashCache2[d],"undefined"==typeof j&&(e.hashCache2[d]=j=h(g,d))):j=h(g),"undefined"==typeof j?!1:i===j)}var f=a("../contexts/diff").DiffContext,g=a("../contexts/patch").PatchContext,h=a("../contexts/reverse").ReverseContext,i=a("./lcs"),j=3,k="function"==typeof Array.isArray?Array.isArray:function(a){return a instanceof Array},l="function"==typeof Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){for(var c=a.length,d=0;c>d;d++)if(a[d]===b)return d;return-1},m=function(a){if(a.leftIsArray){var b,c,g,h,k={objectHash:a.options&&a.options.objectHash,matchByPosition:a.options&&a.options.matchByPosition},m=0,n=0,o=a.left,p=a.right,q=o.length,r=p.length;for(q>0&&r>0&&!k.objectHash&&"boolean"!=typeof k.matchByPosition&&(k.matchByPosition=!d(o,p,q,r));q>m&&r>m&&e(o,p,m,m,k);)b=m,h=new f(a.left[b],a.right[b]),a.push(h,b),m++;for(;q>n+m&&r>n+m&&e(o,p,q-1-n,r-1-n,k);)c=q-1-n,g=r-1-n,h=new f(a.left[c],a.right[g]),a.push(h,g),n++;var s;if(m+n===q){if(q===r)return void a.setResult(void 0).exit();for(s=s||{_t:"a"},b=m;r-n>b;b++)s[b]=[p[b]];return void a.setResult(s).exit()}if(m+n===r){for(s=s||{_t:"a"},b=m;q-n>b;b++)s["_"+b]=[o[b],0,0];return void a.setResult(s).exit()}delete k.hashCache1,delete k.hashCache2;var t=o.slice(m,q-n),u=p.slice(m,r-n),v=i.get(t,u,e,k),w=[];for(s=s||{_t:"a"},b=m;q-n>b;b++)l(v.indices1,b-m)<0&&(s["_"+b]=[o[b],0,0],w.push(b));var x=!0;a.options&&a.options.arrays&&a.options.arrays.detectMove===!1&&(x=!1);var y=!1;a.options&&a.options.arrays&&a.options.arrays.includeValueOnMove&&(y=!0);var z=w.length;for(b=m;r-n>b;b++){var A=l(v.indices2,b-m);if(0>A){var B=!1;if(x&&z>0)for(var C=0;z>C;C++)if(c=w[C],e(t,u,c-m,b-m,k)){s["_"+c].splice(1,2,b,j),y||(s["_"+c][0]=""),g=b,h=new f(a.left[c],a.right[g]),a.push(h,g),w.splice(C,1),B=!0;break}B||(s[b]=[p[b]])}else c=v.indices1[A]+m,g=v.indices2[A]+m,h=new f(a.left[c],a.right[g]),a.push(h,g)}a.setResult(s).exit()}};m.filterName="arrays";var n={numerically:function(a,b){return a-b},numericallyBy:function(a){return function(b,c){return b[a]-c[a]}}},o=function(a){if(a.nested&&"a"===a.delta._t){var b,c,d=a.delta,e=a.left,f=[],h=[],i=[];for(b in d)if("_t"!==b)if("_"===b[0]){if(0!==d[b][2]&&d[b][2]!==j)throw new Error("only removal or move can be applied at original array indices, invalid diff type: "+d[b][2]);f.push(parseInt(b.slice(1),10))}else 1===d[b].length?h.push({index:parseInt(b,10),value:d[b][0]}):i.push({index:parseInt(b,10),delta:d[b]});for(f=f.sort(n.numerically),b=f.length-1;b>=0;b--){c=f[b];var k=d["_"+c],l=e.splice(c,1)[0];k[2]===j&&h.push({index:k[1],value:l})}h=h.sort(n.numericallyBy("index"));var m=h.length;for(b=0;m>b;b++){var o=h[b];e.splice(o.index,0,o.value)}var p,q=i.length;if(q>0)for(b=0;q>b;b++){var r=i[b];p=new g(a.left[r.index],r.delta),a.push(p,r.index)}return a.children?void a.exit():void a.setResult(a.left).exit()}};o.filterName="arrays";var p=function(a){if(a&&a.children&&"a"===a.delta._t){for(var b,c=a.children.length,d=0;c>d;d++)b=a.children[d],a.left[b.childName]=b.result;a.setResult(a.left).exit()}};p.filterName="arraysCollectChildren";var q=function(a){if(!a.nested)return void(a.delta[2]===j&&(a.newName="_"+a.delta[1],a.setResult([a.delta[0],parseInt(a.childName.substr(1),10),j]).exit()));if("a"===a.delta._t){var b,c;for(b in a.delta)"_t"!==b&&(c=new h(a.delta[b]),a.push(c,b));a.exit()}};q.filterName="arrays";var r=function(a,b,c){if("string"==typeof b&&"_"===b[0])return parseInt(b.substr(1),10);if(k(c)&&0===c[2])return"_"+b;var d=+b;for(var e in a){var f=a[e];if(k(f))if(f[2]===j){var g=parseInt(e.substr(1),10),h=f[1];if(h===+b)return g;d>=g&&h>d?d++:g>=d&&d>h&&d--}else if(0===f[2]){var i=parseInt(e.substr(1),10);d>=i&&d++}else 1===f.length&&d>=e&&d--}return d},s=function(a){if(a&&a.children&&"a"===a.delta._t){for(var b,c=a.children.length,d={_t:"a"},e=0;c>e;e++){b=a.children[e];var f=b.newName;"undefined"==typeof f&&(f=r(a.delta,b.childName,b.result)),d[f]!==b.result&&(d[f]=b.result)}a.setResult(d).exit()}};s.filterName="arraysCollectChildren",c.diffFilter=m,c.patchFilter=o,c.collectChildrenPatchFilter=p,c.reverseFilter=q,c.collectChildrenReverseFilter=s},{"../contexts/diff":4,"../contexts/patch":5,"../contexts/reverse":6,"./lcs":12}],11:[function(a,b,c){var d=function(a){a.left instanceof Date?(a.right instanceof Date?a.left.getTime()!==a.right.getTime()?a.setResult([a.left,a.right]):a.setResult(void 0):a.setResult([a.left,a.right]),a.exit()):a.right instanceof Date&&a.setResult([a.left,a.right]).exit()};d.filterName="dates",c.diffFilter=d},{}],12:[function(a,b,c){var d=function(a,b,c,d){return a[c]===b[d]},e=function(a,b,c,d){var e,f,g=a.length,h=b.length,i=[g+1];for(e=0;g+1>e;e++)for(i[e]=[h+1],f=0;h+1>f;f++)i[e][f]=0;for(i.match=c,e=1;g+1>e;e++)for(f=1;h+1>f;f++)c(a,b,e-1,f-1,d)?i[e][f]=i[e-1][f-1]+1:i[e][f]=Math.max(i[e-1][f],i[e][f-1]);return i},f=function(a,b,c,d,e,g){if(0===d||0===e)return{sequence:[],indices1:[],indices2:[]};if(a.match(b,c,d-1,e-1,g)){var h=f(a,b,c,d-1,e-1,g);return h.sequence.push(b[d-1]),h.indices1.push(d-1),h.indices2.push(e-1),h}return a[d][e-1]>a[d-1][e]?f(a,b,c,d,e-1,g):f(a,b,c,d-1,e,g)},g=function(a,b,c,g){g=g||{};var h=e(a,b,c||d,g),i=f(h,a,b,a.length,b.length,g);return"string"==typeof a&&"string"==typeof b&&(i.sequence=i.sequence.join("")),i};c.get=g},{}],13:[function(a,b,c){var d=a("../contexts/diff").DiffContext,e=a("../contexts/patch").PatchContext,f=a("../contexts/reverse").ReverseContext,g=function(a){if(a&&a.children){for(var b,c=a.children.length,d=a.result,e=0;c>e;e++)b=a.children[e],"undefined"!=typeof b.result&&(d=d||{},d[b.childName]=b.result);d&&a.leftIsArray&&(d._t="a"),a.setResult(d).exit()}};g.filterName="collectChildren";var h=function(a){if(!a.leftIsArray&&"object"===a.leftType){var b,c;for(b in a.left)c=new d(a.left[b],a.right[b]),a.push(c,b);for(b in a.right)"undefined"==typeof a.left[b]&&(c=new d(void 0,a.right[b]),a.push(c,b));return a.children&&0!==a.children.length?void a.exit():void a.setResult(void 0).exit()}};h.filterName="objects";var i=function(a){if(a.nested&&!a.delta._t){var b,c;for(b in a.delta)c=new e(a.left[b],a.delta[b]),a.push(c,b);a.exit()}};i.filterName="objects";var j=function(a){if(a&&a.children&&!a.delta._t){for(var b,c=a.children.length,d=0;c>d;d++)b=a.children[d],a.left.hasOwnProperty(b.childName)&&void 0===b.result?delete a.left[b.childName]:a.left[b.childName]!==b.result&&(a.left[b.childName]=b.result);a.setResult(a.left).exit()}};j.filterName="collectChildren";var k=function(a){if(a.nested&&!a.delta._t){var b,c;for(b in a.delta)c=new f(a.delta[b]),a.push(c,b);a.exit()}};k.filterName="objects";var l=function(a){if(a&&a.children&&!a.delta._t){for(var b,c=a.children.length,d={},e=0;c>e;e++)b=a.children[e],d[b.childName]!==b.result&&(d[b.childName]=b.result);a.setResult(d).exit()}};l.filterName="collectChildren",c.collectChildrenDiffFilter=g,c.objectsDiffFilter=h,c.patchFilter=i,c.collectChildrenPatchFilter=j,c.reverseFilter=k,c.collectChildrenReverseFilter=l},{"../contexts/diff":4,"../contexts/patch":5,"../contexts/reverse":6}],14:[function(a,b,c){var d=2,e=60,f=null,g=function(){if(!f){var b;if("undefined"!=typeof diff_match_patch)b="function"==typeof diff_match_patch?new diff_match_patch:new diff_match_patch.diff_match_patch;else if("function"==typeof a)try{var c="diff_match_patch_uncompressed",d=a("../../public/external/"+c);b=new d.diff_match_patch}catch(e){b=null}if(!b){var g=new Error("text diff_match_patch library not found");throw g.diff_match_patch_not_found=!0,g}f={diff:function(a,c){return b.patch_toText(b.patch_make(a,c))},patch:function(a,c){for(var d=b.patch_apply(b.patch_fromText(c),a),e=0;e<d[1].length;e++)if(!d[1][e]){var f=new Error("text patch failed");f.textPatchFailed=!0}return d[0]}}}return f},h=function(a){if("string"===a.leftType){var b=a.options&&a.options.textDiff&&a.options.textDiff.minLength||e;if(a.left.length<b||a.right.length<b)return void a.setResult([a.left,a.right]).exit();var c=g().diff;a.setResult([c(a.left,a.right),0,d]).exit()}};h.filterName="texts";var i=function(a){if(!a.nested&&a.delta[2]===d){var b=g().patch;a.setResult(b(a.left,a.delta[0])).exit()}};i.filterName="texts";var j=function(a){var b,c,d,e,f,g,h,i,j=null,k=/^@@ +\-(\d+),(\d+) +\+(\d+),(\d+) +@@$/;for(d=a.split("\n"),b=0,c=d.length;c>b;b++){e=d[b];var l=e.slice(0,1);"@"===l?(j=k.exec(e),g=b,h=null,i=null,d[g]="@@ -"+j[3]+","+j[4]+" +"+j[1]+","+j[2]+" @@"):"+"===l?(h=b,d[b]="-"+d[b].slice(1),"+"===d[b-1].slice(0,1)&&(f=d[b],d[b]=d[b-1],d[b-1]=f)):"-"===l&&(i=b,d[b]="+"+d[b].slice(1))}return d.join("\n")},k=function(a){a.nested||a.delta[2]===d&&a.setResult([j(a.delta[0]),0,d]).exit()};k.filterName="texts",c.diffFilter=h,c.patchFilter=i,c.reverseFilter=k},{}],15:[function(a,b,c){var d="function"==typeof Array.isArray?Array.isArray:function(a){return a instanceof Array},e=function(a){if(a.left===a.right)return void a.setResult(void 0).exit();if("undefined"==typeof a.left){if("function"==typeof a.right)throw new Error("functions are not supported");return void a.setResult([a.right]).exit()}if("undefined"==typeof a.right)return void a.setResult([a.left,0,0]).exit();if("function"==typeof a.left||"function"==typeof a.right)throw new Error("functions are not supported");return a.leftType=null===a.left?"null":typeof a.left,a.rightType=null===a.right?"null":typeof a.right,a.leftType!==a.rightType?void a.setResult([a.left,a.right]).exit():"boolean"===a.leftType||"number"===a.leftType?void a.setResult([a.left,a.right]).exit():("object"===a.leftType&&(a.leftIsArray=d(a.left)),"object"===a.rightType&&(a.rightIsArray=d(a.right)),a.leftIsArray!==a.rightIsArray?void a.setResult([a.left,a.right]).exit():void 0)};e.filterName="trivial";var f=function(a){return"undefined"==typeof a.delta?void a.setResult(a.left).exit():(a.nested=!d(a.delta),a.nested?void 0:1===a.delta.length?void a.setResult(a.delta[0]).exit():2===a.delta.length?void a.setResult(a.delta[1]).exit():3===a.delta.length&&0===a.delta[2]?void a.setResult(void 0).exit():void 0)};f.filterName="trivial";var g=function(a){return"undefined"==typeof a.delta?void a.setResult(a.delta).exit():(a.nested=!d(a.delta),a.nested?void 0:1===a.delta.length?void a.setResult([a.delta[0],0,0]).exit():2===a.delta.length?void a.setResult([a.delta[1],a.delta[0]]).exit():3===a.delta.length&&0===a.delta[2]?void a.setResult([a.delta[0]]).exit():void 0)};g.filterName="trivial",c.diffFilter=e,c.patchFilter=f,c.reverseFilter=g},{}],16:[function(a,b,c){var d=a("./environment"),e=a("./diffpatcher").DiffPatcher;c.DiffPatcher=e,c.create=function(a){return new e(a)},c.dateReviver=a("./date-reviver");var f;if(c.diff=function(){return f||(f=new e),f.diff.apply(f,arguments)},c.patch=function(){return f||(f=new e),f.patch.apply(f,arguments)},c.unpatch=function(){return f||(f=new e),f.unpatch.apply(f,arguments)},c.reverse=function(){return f||(f=new e),f.reverse.apply(f,arguments)},d.isBrowser)c.homepage="{{package-homepage}}",c.version="{{package-version}}";else{var g="../package.json",h=a(g);c.homepage=h.homepage,c.version=h.version;var i="./formatters",j=a(i);c.formatters=j,c.console=j.console}},{"./date-reviver":7,"./diffpatcher":8,"./environment":9}],17:[function(a,b,c){var d=function(a){this.name=a,this.filters=[]};d.prototype.process=function(a){if(!this.processor)throw new Error("add this pipe to a processor before using it");for(var b=this.debug,c=this.filters.length,d=a,e=0;c>e;e++){var f=this.filters[e];if(b&&this.log("filter: "+f.filterName),f(d),"object"==typeof d&&d.exiting){d.exiting=!1;break}}!d.next&&this.resultCheck&&this.resultCheck(d)},d.prototype.log=function(a){console.log("[jsondiffpatch] "+this.name+" pipe, "+a)},d.prototype.append=function(){return this.filters.push.apply(this.filters,arguments),this},d.prototype.prepend=function(){return this.filters.unshift.apply(this.filters,arguments),this},d.prototype.indexOf=function(a){if(!a)throw new Error("a filter name is required");for(var b=0;b<this.filters.length;b++){var c=this.filters[b];if(c.filterName===a)return b}throw new Error("filter not found: "+a)},d.prototype.list=function(){for(var a=[],b=0;b<this.filters.length;b++){var c=this.filters[b];a.push(c.filterName)}return a},d.prototype.after=function(a){var b=this.indexOf(a),c=Array.prototype.slice.call(arguments,1);if(!c.length)throw new Error("a filter is required");return c.unshift(b+1,0),Array.prototype.splice.apply(this.filters,c),this},d.prototype.before=function(a){var b=this.indexOf(a),c=Array.prototype.slice.call(arguments,1);if(!c.length)throw new Error("a filter is required");return c.unshift(b,0),Array.prototype.splice.apply(this.filters,c),this},d.prototype.clear=function(){return this.filters.length=0,this},d.prototype.shouldHaveResult=function(a){if(a===!1)return void(this.resultCheck=null);if(!this.resultCheck){var b=this;return this.resultCheck=function(a){if(!a.hasResult){console.log(a);var c=new Error(b.name+" failed");throw c.noResult=!0,c}},this}},c.Pipe=d},{}],18:[function(a,b,c){var d=function(a){this.selfOptions=a,this.pipes={}};d.prototype.options=function(a){return a&&(this.selfOptions=a),this.selfOptions},d.prototype.pipe=function(a,b){if("string"==typeof a){if("undefined"==typeof b)return this.pipes[a];this.pipes[a]=b}if(a&&a.name){if(b=a,b.processor===this)return b;this.pipes[b.name]=b}return b.processor=this,b},d.prototype.process=function(a,b){var c=a;c.options=this.options();for(var d,e,f=b||a.pipe||"default";f;)"undefined"!=typeof c.nextAfterChildren&&(c.next=c.nextAfterChildren,c.nextAfterChildren=null),"string"==typeof f&&(f=this.pipe(f)),f.process(c),e=c,d=f,f=null,c&&c.next&&(c=c.next,f=e.nextPipe||c.pipe||d);return c.hasResult?c.result:void 0},c.Processor=d},{}],19:[function(a,b,c){function d(a,b,c){for(var d=-1,e=g(b),f=e.length;++d<f;){var h=e[d],i=a[h],j=c(i,b[h],h,a,b);(j===j?j===i:i!==i)&&(void 0!==i||h in a)||(a[h]=j)}return a}var e=a("lodash._baseassign"),f=a("lodash._createassigner"),g=a("lodash.keys"),h=f(function(a,b,c){return c?d(a,b,c):e(a,b)});b.exports=h},{"lodash._baseassign":20,"lodash._createassigner":22,"lodash.keys":26}],20:[function(a,b,c){function d(a,b){return null==b?a:e(b,f(b),a)}var e=a("lodash._basecopy"),f=a("lodash.keys");b.exports=d},{"lodash._basecopy":21,"lodash.keys":26}],21:[function(a,b,c){function d(a,b,c){c||(c={});for(var d=-1,e=b.length;++d<e;){var f=b[d];c[f]=a[f]}return c}b.exports=d},{}],22:[function(a,b,c){function d(a){return g(function(b,c){var d=-1,g=null==b?0:c.length,h=g>2?c[g-2]:void 0,i=g>2?c[2]:void 0,j=g>1?c[g-1]:void 0;for("function"==typeof h?(h=e(h,j,5),g-=2):(h="function"==typeof j?j:void 0,g-=h?1:0),i&&f(c[0],c[1],i)&&(h=3>g?void 0:h,g=1);++d<g;){var k=c[d];k&&a(b,k,h)}return b})}var e=a("lodash._bindcallback"),f=a("lodash._isiterateecall"),g=a("lodash.restparam");b.exports=d},{"lodash._bindcallback":23,"lodash._isiterateecall":24,"lodash.restparam":25}],23:[function(a,b,c){function d(a,b,c){if("function"!=typeof a)return e;if(void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)};case 5:return function(c,d,e,f,g){return a.call(b,c,d,e,f,g)}}return function(){return a.apply(b,arguments)}}function e(a){return a}b.exports=d},{}],24:[function(a,b,c){function d(a){return function(b){return null==b?void 0:b[a]}}function e(a){return null!=a&&h(l(a))}function f(a,b){return a="number"==typeof a||j.test(a)?+a:-1,b=null==b?k:b,a>-1&&a%1==0&&b>a}function g(a,b,c){if(!i(c))return!1;var d=typeof b;if("number"==d?e(c)&&f(b,c.length):"string"==d&&b in c){var g=c[b];return a===a?a===g:g!==g}return!1}function h(a){return"number"==typeof a&&a>-1&&a%1==0&&k>=a}function i(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}var j=/^\d+$/,k=9007199254740991,l=d("length");b.exports=g},{}],25:[function(a,b,c){function d(a,b){if("function"!=typeof a)throw new TypeError(e);return b=f(void 0===b?a.length-1:+b||0,0),function(){for(var c=arguments,d=-1,e=f(c.length-b,0),g=Array(e);++d<e;)g[d]=c[b+d];switch(b){case 0:return a.call(this,g);case 1:return a.call(this,c[0],g);case 2:return a.call(this,c[0],c[1],g)}var h=Array(b+1);for(d=-1;++d<b;)h[d]=c[d];return h[b]=g,a.apply(this,h)}}var e="Expected a function",f=Math.max;b.exports=d},{}],26:[function(a,b,c){function d(a){return function(b){return null==b?void 0:b[a]}}function e(a){return null!=a&&g(s(a))}function f(a,b){return a="number"==typeof a||n.test(a)?+a:-1,b=null==b?r:b,a>-1&&a%1==0&&b>a}function g(a){return"number"==typeof a&&a>-1&&a%1==0&&r>=a}function h(a){for(var b=j(a),c=b.length,d=c&&a.length,e=!!d&&g(d)&&(m(a)||l(a)),h=-1,i=[];++h<c;){var k=b[h];(e&&f(k,d)||p.call(a,k))&&i.push(k)}return i}function i(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function j(a){if(null==a)return[];i(a)||(a=Object(a));var b=a.length;b=b&&g(b)&&(m(a)||l(a))&&b||0;for(var c=a.constructor,d=-1,e="function"==typeof c&&c.prototype===a,h=Array(b),j=b>0;++d<b;)h[d]=d+"";for(var k in a)j&&f(k,b)||"constructor"==k&&(e||!p.call(a,k))||h.push(k);return h}var k=a("lodash._getnative"),l=a("lodash.isarguments"),m=a("lodash.isarray"),n=/^\d+$/,o=Object.prototype,p=o.hasOwnProperty,q=k(Object,"keys"),r=9007199254740991,s=d("length"),t=q?function(a){var b=null==a?void 0:a.constructor;return"function"==typeof b&&b.prototype===a||"function"!=typeof a&&e(a)?h(a):i(a)?q(a):[]}:h;b.exports=t},{"lodash._getnative":27,"lodash.isarguments":28,"lodash.isarray":29}],27:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}function e(a,b){var c=null==a?void 0:a[b];return h(c)?c:void 0}function f(a){return g(a)&&n.call(a)==i}function g(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function h(a){return null==a?!1:f(a)?o.test(l.call(a)):d(a)&&j.test(a)}var i="[object Function]",j=/^\[object .+?Constructor\]$/,k=Object.prototype,l=Function.prototype.toString,m=k.hasOwnProperty,n=k.toString,o=RegExp("^"+l.call(m).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");b.exports=e},{}],28:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}function e(a){return function(b){return null==b?void 0:b[a]}}function f(a){return null!=a&&g(m(a))}function g(a){return"number"==typeof a&&a>-1&&a%1==0&&l>=a}function h(a){return d(a)&&f(a)&&j.call(a,"callee")&&!k.call(a,"callee")}var i=Object.prototype,j=i.hasOwnProperty,k=i.propertyIsEnumerable,l=9007199254740991,m=e("length");b.exports=h},{}],29:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}function e(a,b){var c=null==a?void 0:a[b];return i(c)?c:void 0}function f(a){return"number"==typeof a&&a>-1&&a%1==0&&s>=a}function g(a){return h(a)&&p.call(a)==k}function h(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function i(a){return null==a?!1:g(a)?q.test(n.call(a)):d(a)&&l.test(a)}var j="[object Array]",k="[object Function]",l=/^\[object .+?Constructor\]$/,m=Object.prototype,n=Function.prototype.toString,o=m.hasOwnProperty,p=m.toString,q=RegExp("^"+n.call(o).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),r=e(Array,"isArray"),s=9007199254740991,t=r||function(a){return d(a)&&f(a.length)&&p.call(a)==j};b.exports=t},{}],30:[function(a,b,c){var d=a("lodash._createwrapper"),e=a("lodash._replaceholders"),f=a("lodash.restparam"),g=1,h=32,i=f(function(a,b,c){var f=g;if(c.length){var j=e(c,i.placeholder);f|=h}return d(a,f,b,c,j)});i.placeholder={},b.exports=i},{"lodash._createwrapper":31,"lodash._replaceholders":34,"lodash.restparam":35}],31:[function(a,b,c){(function(c){function d(a,b,c){for(var d=c.length,e=-1,f=A(a.length-d,0),g=-1,h=b.length,i=Array(h+f);++g<h;)i[g]=b[g];for(;++e<d;)i[c[e]]=a[e];for(;f--;)i[g++]=a[e++];return i}function e(a,b,c){for(var d=-1,e=c.length,f=-1,g=A(a.length-e,0),h=-1,i=b.length,j=Array(g+i);++f<g;)j[f]=a[f];for(var k=f;++h<i;)j[k+h]=b[h];for(;++d<e;)j[k+c[d]]=a[f++];return j}function f(a,b){function d(){var f=this&&this!==c&&this instanceof d?e:a;return f.apply(b,arguments)}var e=g(a);return d}function g(a){return function(){var b=arguments;switch(b.length){case 0:return new a;case 1:return new a(b[0]);case 2:return new a(b[0],b[1]);case 3:return new a(b[0],b[1],b[2]);case 4:return new a(b[0],b[1],b[2],b[3]);case 5:return new a(b[0],b[1],b[2],b[3],b[4]);case 6:return new a(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6])}var c=o(a.prototype),d=a.apply(c,b);return m(d)?d:c}}function h(a,b,f,i,j,k,m,o,y,z){function B(){for(var s=arguments.length,t=s,u=Array(s);t--;)u[t]=arguments[t];if(i&&(u=d(u,i,j)),k&&(u=e(u,k,m)),F||H){var x=B.placeholder,J=p(u,x);if(s-=J.length,z>s){var K=o?n(o):void 0,L=A(z-s,0),M=F?J:void 0,N=F?void 0:J,O=F?u:void 0,P=F?void 0:u;b|=F?v:w,b&=~(F?w:v),G||(b&=~(q|r));var Q=h(a,b,f,O,M,P,N,K,y,L);return Q.placeholder=x,Q}}var R=D?f:this,S=E?R[a]:a;return o&&(u=l(u,o)),C&&y<u.length&&(u.length=y),this&&this!==c&&this instanceof B&&(S=I||g(a)),S.apply(R,u)}var C=b&x,D=b&q,E=b&r,F=b&t,G=b&s,H=b&u,I=E?void 0:g(a);return B}function i(a,b,d,e){function f(){for(var b=-1,g=arguments.length,j=-1,k=e.length,l=Array(k+g);++j<k;)l[j]=e[j];for(;g--;)l[j++]=arguments[++b];var m=this&&this!==c&&this instanceof f?i:a;return m.apply(h?d:this,l)}var h=b&q,i=g(a);return f}function j(a,b,c,d,e,g,j,k){var l=b&r;if(!l&&"function"!=typeof a)throw new TypeError(y);var m=d?d.length:0;if(m||(b&=~(v|w),d=e=void 0),m-=e?e.length:0,b&w){var n=d,o=e;d=e=void 0}var p=[a,b,c,d,e,n,o,g,j,k];if(p[9]=null==k?l?0:a.length:A(k-m,0)||0,b==q)var s=f(p[0],p[2]);else s=b!=v&&b!=(q|v)||p[4].length?h.apply(void 0,p):i.apply(void 0,p);return s}function k(a,b){return a="number"==typeof a||z.test(a)?+a:-1,b=null==b?C:b,a>-1&&a%1==0&&b>a}function l(a,b){for(var c=a.length,d=B(b.length,c),e=n(a);d--;){var f=b[d];a[d]=k(f,c)?e[f]:void 0}return a}function m(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}var n=a("lodash._arraycopy"),o=a("lodash._basecreate"),p=a("lodash._replaceholders"),q=1,r=2,s=4,t=8,u=16,v=32,w=64,x=128,y="Expected a function",z=/^\d+$/,A=Math.max,B=Math.min,C=9007199254740991;b.exports=j}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"lodash._arraycopy":32,"lodash._basecreate":33,"lodash._replaceholders":34}],32:[function(a,b,c){function d(a,b){var c=-1,d=a.length;for(b||(b=Array(d));++c<d;)b[c]=a[c];return b}b.exports=d},{}],33:[function(a,b,c){function d(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}var e=function(){function a(){}return function(b){if(d(b)){a.prototype=b;var c=new a;a.prototype=void 0}return c||{}}}();b.exports=e},{}],34:[function(a,b,c){function d(a,b){for(var c=-1,d=a.length,f=-1,g=[];++c<d;)a[c]===b&&(a[c]=e,g[++f]=c);return g}var e="__lodash_placeholder__";b.exports=d},{}],35:[function(a,b,c){arguments[4][25][0].apply(c,arguments)},{dup:25}],36:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}function e(a){return function(b){return null==b?void 0:b[a]}}function f(a){return null!=a&&g(o(a))}function g(a){return"number"==typeof a&&a>-1&&a%1==0&&n>=a}function h(a){return null==a?!0:f(a)&&(j(a)||l(a)||i(a)||d(a)&&k(a.splice))?!a.length:!m(a).length}var i=a("lodash.isarguments"),j=a("lodash.isarray"),k=a("lodash.isfunction"),l=a("lodash.isstring"),m=a("lodash.keys"),n=9007199254740991,o=e("length");b.exports=h},{"lodash.isarguments":37,"lodash.isarray":38,"lodash.isfunction":39,"lodash.isstring":40,"lodash.keys":41}],37:[function(a,b,c){arguments[4][28][0].apply(c,arguments)},{dup:28}],38:[function(a,b,c){arguments[4][29][0].apply(c,arguments)},{dup:29}],39:[function(a,b,c){function d(a){return e(a)&&h.call(a)==f}function e(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}var f="[object Function]",g=Object.prototype,h=g.toString;b.exports=d},{}],40:[function(a,b,c){function d(a){return!!a&&"object"==typeof a;
}function e(a){return"string"==typeof a||d(a)&&h.call(a)==f}var f="[object String]",g=Object.prototype,h=g.toString;b.exports=e},{}],41:[function(a,b,c){arguments[4][26][0].apply(c,arguments)},{dup:26,"lodash._getnative":42,"lodash.isarguments":37,"lodash.isarray":38}],42:[function(a,b,c){arguments[4][27][0].apply(c,arguments)},{dup:27}],43:[function(a,b,c){var d=function(a){this.cache=a||{}};d.prototype.getData=function(a,b){var c=this.cache[a];c||(this.cache[a]={}),b(null,this.cache[a])},d.prototype.storeData=function(a,b,c){this.cache[a]=b,c&&c(null)},b.exports=d},{}],44:[function(a,b,c){var d,e=a("lodash.assign"),f=a("lodash.bind"),g=a("lodash.isempty"),h=a("events").EventEmitter,i=a("jsondiffpatch"),j=a("./commands"),k=a("./utils");d=function(a,b,c){if(!a)throw new Error("No socket specified");b||(b=""),c||(c={}),this.socket=a,this.room=b,this.syncing=!1,this.initialized=!1,this.scheduled=!1,this.doc={localVersion:0,serverVersion:0,shadow:{},localCopy:{},edits:[]},c=e({objectHash:function(a){return a.id||a._id||JSON.stringify(a)}},c),this.jsondiffpatch=i.create(c),h.call(this);var d,g=["_onConnected","syncWithServer","applyServerEdit","applyServerEdits","schedule","onRemoteUpdate"];for(var j in g)d=g[j],this[d]=f(this[d],this)},d.prototype=h.prototype,d.prototype.getData=function(){return this.doc.localCopy},d.prototype.initialize=function(){this.syncing=!0,this.socket.emit(j.join,this.room,this._onConnected)},d.prototype._onConnected=function(a){this.syncing=!1,this.initialized=!0,this.doc.shadow=k.deepCopy(a),this.doc.localCopy=a,this.doc.serverVersion=0,this.socket.on(j.remoteUpdateIncoming,this.onRemoteUpdate),this.emit("connected")},d.prototype.onRemoteUpdate=function(a){this.socket.id!==a&&this.schedule()},d.prototype.schedule=function(){this.scheduled||(this.scheduled=!0,this.syncWithServer())},d.prototype.sync=function(){this.schedule()},d.prototype.syncWithServer=function(){if(this.syncing||!this.initialized)return!1;this.scheduled&&(this.scheduled=!1),this.syncing=!0;var a=this.createDiff(this.doc.shadow,this.doc.localCopy),b=this.doc.localVersion;g(a)||(this.doc.edits.push(this.createDiffMessage(a,b)),this.doc.localVersion++);var c=this.createEditMessage(b);return this.applyPatchTo(this.doc.shadow,k.deepCopy(a)),this.sendEdits(c),!0},d.prototype.createDiff=function(a,b){return this.jsondiffpatch.diff(a,b)},d.prototype.applyPatchTo=function(a,b){this.jsondiffpatch.patch(a,b)},d.prototype.createDiffMessage=function(a,b){return{serverVersion:this.doc.serverVersion,localVersion:b,diff:a}},d.prototype.createEditMessage=function(a){return{room:this.room,edits:this.doc.edits,localVersion:a,serverVersion:this.doc.serverVersion}},d.prototype.sendEdits=function(a){this.socket.emit(j.syncWithServer,a,this.applyServerEdits)},d.prototype.applyServerEdits=function(a){a&&a.localVersion===this.doc.localVersion?(this.doc.edits=[],a.edits.forEach(this.applyServerEdit)):this.emit("error","REJECTED_PATCH"),this.syncing=!1,this.emit("synced"),this.scheduled&&this.syncWithServer()},d.prototype.applyServerEdit=function(a){return a.localVersion===this.doc.localVersion&&a.serverVersion===this.doc.serverVersion?(g(a.diff)||(this.applyPatchTo(this.doc.shadow,a.diff),this.doc.serverVersion++,this.applyPatchTo(this.doc.localCopy,k.deepCopy(a.diff))),!0):!1},b.exports=d},{"./commands":45,"./utils":47,events:1,jsondiffpatch:16,"lodash.assign":19,"lodash.bind":30,"lodash.isempty":36}],45:[function(a,b,c){b.exports={join:"diffsync-join",syncWithServer:"diffsync-send-edit",remoteUpdateIncoming:"diffsync-updated-doc",error:"diffsync-error"}},{}],46:[function(a,b,c){var d,e=a("lodash.assign"),f=a("lodash.bind"),g=a("lodash.isempty"),h=a("jsondiffpatch"),i=a("./commands"),j=a("./utils");d=function(a,b,c){if(!a||!b)throw new Error("Need to specify an adapter and a transport");c||(c={}),this.adapter=a,this.transport=b,this.data={},this.requests={},this.saveRequests={},this.saveQueue={},this.trackConnection=f(this.trackConnection,this),c=e({objectHash:function(a){return a.id||a._id||JSON.stringify(a)}},c),this.jsondiffpatch=h.create(c),this.transport.on("connection",this.trackConnection)},d.prototype.trackConnection=function(a){a.on(i.join,this.joinConnection.bind(this,a)),a.on(i.syncWithServer,this.receiveEdit.bind(this,a))},d.prototype.joinConnection=function(a,b,c){this.getData(b,function(d,e){a.join(b),e.clientVersions[a.id]={backup:{doc:j.deepCopy(e.serverCopy),serverVersion:0},shadow:{doc:j.deepCopy(e.serverCopy),serverVersion:0,localVersion:0},edits:[]},c(e.serverCopy)})},d.prototype.getData=function(a,b){var c=this.data[a],d=this.data,e=this.requests;c?b(null,c):e[a]?e[a]=!0:(e[a]=!0,this.adapter.getData(a,function(c,f){d[a]={registeredSockets:[],clientVersions:{},serverCopy:f},e[a]=!1,b(null,d[a])}))},d.prototype.receiveEdit=function(a,b,c){this.getData(b.room,function(d,e){var f=e.clientVersions[a.id];return d||!f?void a.emit(i.error,"Need to re-connect!"):(b.serverVersion===f.shadow.serverVersion&&(f.edits=[]),b.edits.forEach(function(a){a.serverVersion===f.shadow.serverVersion&&a.localVersion===f.shadow.localVersion?(f.backup.doc=j.deepCopy(f.shadow.doc),this.jsondiffpatch.patch(f.shadow.doc,j.deepCopy(a.diff)),this.jsondiffpatch.patch(e.serverCopy,j.deepCopy(a.diff)),g(a.diff)||f.shadow.localVersion++):console.log("error","patch rejected!!",a.serverVersion,"->",f.shadow.serverVersion,":",a.localVersion,"->",f.shadow.localVersion)}.bind(this)),this.saveSnapshot(b.room),b.edits.length>0&&this.transport.to(b.room).emit(i.remoteUpdateIncoming,a.id),void this.sendServerChanges(e,f,c))}.bind(this))},d.prototype.saveSnapshot=function(a){var b=!this.saveRequests[a],c=function(){var b=this.saveQueue[a]===!0;this.saveRequests[a]=!1,b&&(this.saveQueue[a]=!1,this.saveSnapshot(a))}.bind(this);b?(this.saveRequests[a]=!0,this.getData(a,function(b,d){!b&&d?this.adapter.storeData(a,d.serverCopy,c):c()}.bind(this))):this.saveQueue[a]=!0},d.prototype.sendServerChanges=function(a,b,c){var d=this.jsondiffpatch.diff(b.shadow.doc,a.serverCopy),e=b.shadow.serverVersion;g(d)||(b.edits.push({serverVersion:e,localVersion:b.shadow.localVersion,diff:d}),b.shadow.serverVersion++,this.jsondiffpatch.patch(b.shadow.doc,j.deepCopy(d))),c({localVersion:b.shadow.localVersion,serverVersion:e,edits:b.edits})},b.exports=d},{"./commands":45,"./utils":47,jsondiffpatch:16,"lodash.assign":19,"lodash.bind":30,"lodash.isempty":36}],47:[function(a,b,c){b.exports={deepCopy:function(a){return null===a||void 0===a?a:JSON.parse(JSON.stringify(a))}}},{}]},{},[2])(2)});var wysihtml5ParserRules={classes:{"wysiwyg-text-align-center":1},tags:{b:{},i:{},hr:{},ul:{},li:{},p:{},tt:{},box:{},code:{check_attributes:{id:"any"}},span:{},"var":{},img:{check_attributes:{id:"any"}}}};angular.module("grademanagerApp",["ngAnimate","ngMessages","ngRoute","ngSanitize","ngTouch","ngMaterial","ui.tree","ui.router","IeHelper","ngFileUpload","ui.codemirror"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"views/home.html",controller:"HomeCtrl",controllerAs:"home"}).state("edit",{url:"/:project/edit",templateUrl:"views/edit.html",controller:"EditCtrl",controllerAs:"editor",reloadOnSearch:!1}).state("scan",{url:"/:project/scan",templateUrl:"views/scan.html",controller:"ScanCtrl",controllerAs:"scan"}).state("scan.manual",{url:"/:student/:page::copy",templateUrl:"views/scan.preview.html",controller:"ScanPreviewCtrl",controllerAs:"preview"}).state("grade",{url:"/:project/grade",templateUrl:"views/grade.html",controller:"GradeCtrl",controllerAs:"grade"}).state("options",{url:"/:project/options",templateUrl:"views/options.html",controller:"OptionsCtrl",controllerAs:"ctrl"})}]).config(["$mdIconProvider",function(a){a.defaultFontSet("mdi")}]).config(["$mdThemingProvider",function(a){a.theme("default").primaryPalette("blue").accentPalette("grey")}]).config(["$httpProvider",function(a){a.interceptors.push("authInterceptor")}]),angular.forEach([{ngAttrName:"ngXlinkHref",attrName:"xlink:href"}],function(a){var b=a.ngAttrName,c=a.attrName;angular.module("grademanagerApp").directive(b,["IeHelperSrv",function(a){return{priority:99,link:function(d,e,f){f.$observe(b,function(b){b&&(f.$set(c,b),a.isIE&&e.prop(c,b))})}}}])});var checkForIE={init:function(){this.isIE=-1!==navigator.userAgent.indexOf("MSIE")}};angular.module("IeHelper",[]).factory("IeHelperSrv",function(){return{isIE:checkForIE.isIE}}),checkForIE.init(),angular.module("grademanagerApp").controller("AppCtrl",["$scope","$state","$stateParams","$timeout","auth","API",function(a,b,c,d,e,f){var g=this;this.tabIndex=0,this.tabInit=!1,this.hideTabs=!0,this.api=f,this.project=function(){return c.project},this.getUsername=function(){return e.getUsername()},this.isAuthed=function(){var a=e.isAuthed();return a||b.is("home")||d(function(){b.go("home")}),a},this.logout=function(){e.logout(),g.go("home")},this.go=function(a){g.tabInit&&!b.includes(a)?b.go(a,{project:c.project}):g.tabInit=!0},this.linkTo=function(a){return f.URL+"/project/"+c.project+"/static/"+a+"?token="+e.getToken()},a.$on("$stateChangeSuccess",function(){g.hideTabs=b.includes("home"),b.includes("edit")&&(g.tabIndex=0),b.includes("scan")&&(g.tabIndex=1),b.includes("grade")&&(g.tabIndex=2),b.includes("options")&&(g.tabIndex=3)})}]),angular.module("grademanagerApp").controller("AssociationCtrl",["$mdDialog","row","API","students","scores","unmatched","$stateParams","auth","$sce","$http",function(a,b,c,d,e,f,g,h,i,j){function k(a,b){for(var c=0;c<a.length;c++)if(a[c].student===b.student&&a[c].copy===b.copy)return a[c]}var l=this;l.scores=e,l.unmatched=f,l.students=d,l.filterUnmatched=function(a){return!l.scores.hasOwnProperty(a.id)},l.nameSrc=function(){return l.match&&l.match.image?i.trustAsResourceUrl(c.URL+"/project/"+g.project+"/static/cr/"+l.match.image+"?token="+h.getToken()):void 0},j.get(c.URL+"/project/"+g.project+"/names").success(function(a){l.names=a,l.match=k(a,b)||l.nextUnmatched()}),l.nextUnmatched=function(){return l.names.filter(function(a){return!a.auto&&!a.manual}).pop()},l.selectedItemChange=function(a){if(a&&a.id){l.match.manual=a.id;var b=l.match.student+":"+l.match.copy,d=l.unmatched[b];d&&(d.id=a.id,l.scores[d.id]=d,delete l.unmatched[b],j.post(c.URL+"/project/"+g.project+"/association/manual",{student:d.student,copy:d.copy,id:d.id})),l.match=l.nextUnmatched()}},l.closeDialog=function(){a.hide()}}]),angular.module("grademanagerApp").controller("HomeCtrl",["$scope","$state","$mdDialog","auth","exam","API",function(a,b,c,d,e,f){var g=this;g.API=f,g.isAuthed=function(){return d.isAuthed()},g.logout=function(){d.logout()},g.login=function(){g.error="",d.login(g.username,g.password).error(function(a){g.error={error:a}}).success(f.getProjectList)},g.openProject=function(a){a.status&&a.status.annotated?b.go("grade",{project:a.project}):a.status&&a.status.printed?b.go("scan",{project:a.project}):b.go("edit",{project:a.project},{reload:!0})},g.createProject=function(){g.error="",f.createProject(g.newProjectName).success(function(){g.openProject({project:g.newProjectName}),g.newProjectName=""}).error(function(a){g.error={error:a}})},g.copyProject=function(a,b){c.show({clickOutsideToClose:!1,targetEvent:a,templateUrl:"views/promptdialog.html",controller:"PromptDialogCtrl",controllerAs:"ctrl",locals:{options:{title:"Copy project "+b.project,content:"Provide a name for the new copy:",label:"new name",value:""}}}).then(function(a){f.copyProject(b.project,a).success(function(){g.openProject({project:a})})})},g.isAuthed()&&f.getProjectList()}]),angular.module("grademanagerApp").controller("EditCtrl",["$scope","$mdSidenav","$mdDialog","$mdToast","$location","$state","$stateParams","$timeout","API","exam",function(a,b,c,d,e,f,g,h,i,j){function k(){o&&h.cancel(o),(new Date).getTime()-n.lastPreview>n.waitTime?(n.previewWait=!1,j.preview(),n.lastPreview=(new Date).getTime()):(n.previewWait=!0,o=h(k,n.waitTime))}function l(a,b){for(var c=0;c<a.length;c++)if(a[c].id===b)return a[c]}function m(){var a=localStorage.getItem("copy");if(a&&(a=angular.fromJson(a),a.dest===g.project)){for(var b in a.sections)a.sections.hasOwnProperty(b)&&(j.getSection(a.sections[b].id)&&(a.sections[b].id=GUID()),j.exam.sections.push(a.sections[b]));j.exam.graphics||(j.exam.graphics={}),j.exam.codes||(j.exam.codes={}),angular.extend(j.exam.graphics,a.graphics),angular.extend(j.exam.codes,a.codes),i.copyGraphics(a.src,a.dest),d.show(d.simple().content("Content has been copied!").position("top right")),localStorage.removeItem("copy")}}var n=this;n.examService=j,n.API=i,i.loadProject(g.project),a.$watch(function(){return e.search().section},function(a){if(n.examService.exam&&n.examService.exam.sections){var b=n.examService.exam.sections.indexOf(n.section);b>-1&&a>-1&&a!==b&&(n.section=n.examService.exam.sections[a])}}),a.$watch("editor.section",function(a){if(n.examService.exam&&n.examService.exam.sections){var b=n.examService.exam.sections.indexOf(a);b>-1&&e.search().section!==b&&e.search({section:b})}}),n.lastPreview=0,n.waitTime=5e3,n.previewWait=!1,n.linkToQuestion=function(a,b){return"#/"+g.project+"/edit?section="+j.exam.sections.indexOf(a)+"#q"+(b?b.number:"0")};var o;j.load(function(b){a.$watch("editor.examService.exam",function(){n.examService.computeHierarchyNumbers(),b.sync(),k()},!0),a.$on("$destroy",function(){b.removeAllListeners()}),n.examService.exam&&n.examService.exam.sections&&n.examService.exam.sections.length>0?n.section=n.examService.exam.sections[e.search().section||0]:(n.section=n.examService.newSection(),n.examService.exam.sections=[n.section]),m()}),n.leftNav=function(){return b("left")},n.rightNav=function(){return b("right")},n.previousSection=function(){if(n.examService.exam&&n.examService.exam.sections){var a=n.examService.exam.sections.indexOf(n.section);if(a>0)return n.examService.exam.sections[a-1]}},n.nextSection=function(a){if(n.examService.exam&&n.examService.exam.sections){var b=n.examService.exam.sections.indexOf(n.section);if(b<n.examService.exam.sections.length-1)return n.examService.exam.sections[b+1];var c=n.examService.newSection();return a&&h(function(){n.examService.exam.sections.push(c)}),c}},n.removeSection=function(a){var b=n.previousSection();b||(b=n.nextSection(!0)),n.examService.exam.sections.splice(n.examService.exam.sections.indexOf(a),1),n.section=b},n.range=function(a){return new Array(parseInt(a))},n.latexSourceOptions={mode:"stex",lineNumbers:!0,lineWrapping:!0,viewportMargin:1/0,readOnly:!1,matchBrackets:!0,autoCloseBrackets:!0},n.latexPreviewOptions={mode:"stex",lineNumbers:!0,lineWrapping:!0,viewportMargin:1/0,readOnly:"nocursor",matchBrackets:!0},n.jsonPreviewOptions={mode:"application/json",lineNumbers:!0,lineWrapping:!0,viewportMargin:1/0,readOnly:"nocursor",matchBrackets:!0},n.questionIsNoneCorrect=function(a){return a.answers.every(function(a){return!a.correct})},n.showPreviewDialog=function(a){c.show({clickOutsideToClose:!0,templateUrl:"views/edit.preview.html",targetEvent:a,controller:"EditPreviewCtrl",controllerAs:"ctrl"})},n.examMenuOptions={accept:function(a,b){var c,d=a.$modelValue;c=d.hasOwnProperty("questions")?"section":"question";var e=b.$element.attr("data-type");return c===e}},n.copy={},n.copyCheckbox={},n.copySummary=function(){var a=Object.keys(n.copy).length;return{sections:a,questions:Object.keys(n.copyCheckbox).length-a}},n.toggleCopy=function(a,b){var c,d;n.copy.hasOwnProperty(a.id)?(c=n.copy[a.id],b?(d=l(c.questions,b.id),d?(c.questions.splice(c.questions.indexOf(d),1),n.copyCheckbox[b.id]=!1):(c.questions.splice(a.questions.indexOf(b),0,angular.copy(b)),n.copyCheckbox[b.id]=!0)):(c.questions.forEach(function(a){n.copyCheckbox[a.id]=!1}),n.copyCheckbox[a.id]=!1,delete n.copy[a.id])):(c=angular.copy(a),n.copy[a.id]=c,n.copyCheckbox[c.id]=!0,b?(c.questions=[],c.questions.splice(a.questions.indexOf(b),0,angular.copy(b)),n.copyCheckbox[b.id]=!0):c.questions.forEach(function(a){n.copyCheckbox[a.id]=!0}))},n.copyTo=function(){var a=n.copyToName,b={src:g.project,dest:a,sections:n.copy,graphics:{},codes:{}};b.graphics=angular.copy(j.exam.graphics),b.codes=angular.copy(j.exam.codes),localStorage.setItem("copy",angular.toJson(b)),f.go("edit",{project:a},{reload:!0})}}]),angular.module("grademanagerApp").controller("ScanCtrl",["$scope","$mdMedia","$http","$state","$stateParams","API","Upload",function(a,b,c,d,e,f,g){function h(){c.get(f.URL+"/project/"+e.project+"/capture").success(function(a){if(i.pages=a,d.params.student&&d.params.page&&d.params.copy)for(var b=0;b<a.length;b++)a[b].id===d.params.student+"/"+d.params.page+":"+d.params.copy&&(i.page=a[b])}),c.get(f.URL+"/project/"+e.project+"/missing").success(function(a){i.missing=a})}var i=this;f.loadProject(e.project),a.$mdMedia=b,i.orderBy="id",i.reverse=!1,i.uploads=[],i.sort=function(a){a===i.orderBy?i.reverse=!i.reverse:i.orderBy=a},this.loadPage=function(a){i.page=a,a.project=e.project,d.go("scan.manual",a)},this["delete"]=function(a){c.post(f.URL+"/project/"+e.project+"/capture/delete",a).success(function(){i.pages.splice(i.pages.indexOf(a),1)})},a.$watch("scan.files",function(){function a(a){i.uploads.push(a),g.upload({url:f.URL+"/project/"+e.project+"/upload",file:a}).progress(function(b){a.progress=100*b.loaded/b.total}).success(function(){h()})}if(i.files&&i.files.length)for(var b=i.files.slice(0),c=0;c<b.length;c++)a(b[c])}),h()}]),angular.module("grademanagerApp").controller("ScanPreviewCtrl",["$http","$mdMedia","$mdSidenav","$stateParams","$sce","API","auth",function(a,b,c,d,e,f,g){var h=this;a.get(f.URL+"/project/"+d.project+"/capture/"+d.student+"/"+d.page+":"+d.copy).success(function(a){h.page=a}),a.get(f.URL+"/project/"+d.project+"/zones/"+d.student+"/"+d.page+":"+d.copy).success(function(a){h.zones=a}),b("sm")&&c("right").open(),this.pageSrc=function(){return h.page&&h.page.layout_image?e.trustAsResourceUrl(f.URL+"/project/"+d.project+"/static/cr/"+h.page.layout_image+"?token="+g.getToken()):void 0},h.ticked=function(a){return a.manual>=0?1===a.manual:a.total<=0?!1:a.black>=f.options.options.seuil*a.total},h.toggle=function(a){0===a.manual?a.manual=1:1===a.manual?a.manual=0:a.manual=a.black>=f.options.options.seuil*a.total?0:1,f.setZoneManual(d.project,{student:d.student,page:d.page,copy:d.copy,manual:a.manual,type:4,id_a:a.question,id_b:a.answer})},h.clear=function(){h.zones.forEach(function(a){a.manual=-1}),f.setPageAuto(d.project,{student:d.student,page:d.page,copy:d.copy})}}]),angular.module("grademanagerApp").controller("GradeCtrl",["$scope","$mdMedia","$http","$timeout","$stateParams","API","auth","$mdDialog",function(a,b,c,d,e,f,g,h){function i(){s&&d.cancel(s),s=d(function(){c({method:"POST",url:f.URL+"/project/"+e.project+"/csv",headers:{"Content-Type":"text/plain"},data:Papa.unparse(angular.copy(r.students))}).success(j)},1e3)}function j(){c.get(f.URL+"/project/"+e.project+"/scores").success(function(a){r.scores={},r.unmatched={},r.questions={},r.whys={},r.maxPoints=0,a.forEach(function(a){var b=a.student+":"+a.copy,c=b,d="unmatched";a.id&&(c=a.id,d="scores"),r[d].hasOwnProperty(c)||(r[d][c]={id:a.id,key:b,student:a.student,copy:a.copy,questions:{},total:0}),r.questions.hasOwnProperty(a.title)||(r.questions[a.title]={max:a.max,question:a.question,page:a.page},r.maxPoints+=a.max),r[d][c].total+=a.score,r[d][c].questions[a.title]=a.score,r.whys[b+":"+a.question]=a.why}),f.options.options.points_max||(f.options.options.points_max=r.maxPoints),f.options.options.final_grade_formula||(f.options.options.final_grade_formula="row.Grade")})}function k(a){a.stopPropagation(),a.preventDefault(),t.classList.toggle("dragover",!0)}function l(a){a.stopPropagation(),a.preventDefault(),t.classList.toggle("dragover",!1)}function m(a){a.stopPropagation(),a.preventDefault()}function n(a){a.stopPropagation(),a.preventDefault(),t.classList.toggle("dragover",!1);var b=a.dataTransfer,c=b.files;q(c)}function o(b){return function(c){a.$apply(function(){c.name=b,c.studentLookup="row.name.toLowerCase()",c.fileLookup="(row['First Name']  +  ' ' + row.last_name).toLowerCase()",c.demoid=1,u.files.push(c),u.save(),r.pasteData="",r.tabIndex=r.files.length+1})}}function p(a,b){b||(b="CSV#"+u.files.length),d(function(){Papa.parse(a,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:o(b)})})}function q(a){for(var b=0;b<a.length;b++){var c=a[b];p(c,c.name)}}var r=this;f.loadProject(e.project),r.project=e.project,r.statsOrder="title",r.hideAdd=b("sm"),r.students={fields:["id"],data:[]},r.files=[];var s;c.get(f.URL+"/project/"+e.project+"/csv").success(function(b){r.parseCSV(b),a.$watch("grade.students",i,!0)}),c.get(f.URL+"/project/"+e.project+"/stats").success(function(a){r.stats=a}),j(),this.getStudentById=function(a){for(var b=0;b<r.students.data.length;b++)if(r.students.data[b].id===a)return r.students.data[b]},r.parseCSV=function(a){var b=Papa.parse(a,{header:!0,dynamicTyping:!0,skipEmptyLines:!0});b.meta.fields.forEach(function(a){r.students.fields.indexOf(a)<0&&r.students.fields.push(a)}),b.data.forEach(function(a){var b;a.hasOwnProperty("id")||(a.id=r.students.data.reduce(function(a,b){return isNaN(b.id)?a:b.id>a?b.id:a},0)+1),b=u.getStudentById(a.id),b?angular.extend(b,a):r.students.data.push(a)})},r.parsePasteData=function(){r.parseCSV(r.pasteData),r.pasteData=""},r.parseAsNewFile=function(){p(r.pasteData)},r["export"]=function(){r.pasteData=Papa.unparse(angular.copy(r.students))},r.removeStudent=function(a){r.students.data.splice(r.students.data.indexOf(a),1)},r.removeCol=function(a){"id"!==a&&r.students.fields.splice(r.students.fields.indexOf(a),1)},r.annotateScore=function(a){c.post(f.URL+"/project/"+e.project+"/annotate",{ids:[a.copy?a.student+":"+a.copy:a.student]})},r.annotateAll=function(){c.post(f.URL+"/project/"+e.project+"/annotate")},r.showAssociationDialog=function(a,b){h.show({clickOutsideToClose:!0,templateUrl:"views/association.html",targetEvent:a,controller:"AssociationCtrl",controllerAs:"ctrl",locals:{row:b,scores:r.scores,unmatched:r.unmatched,students:r.students}})},r.renameColumn=function(a,b,c,d){var e=b[c];h.show({clickOutsideToClose:!1,targetEvent:a,templateUrl:"views/promptdialog.html",controller:"PromptDialogCtrl",controllerAs:"ctrl",locals:{options:{title:"Rename column ",content:"",label:"Column name",value:e}}}).then(function(a){a&&a!==e&&(b[c]=a,d.forEach(function(b){b.hasOwnProperty(e)&&(b[a]=b[e],delete b[e])}),r.save())})},r.finalGrade="row.Grade * 0.5 + row.NoteCC * 0.5",r.valueSaver=function(a,b,c){return r.students.fields.indexOf(b)<0&&r.students.fields.push(b),c&&!isNaN(c)&&(c=parseFloat(c.toPrecision(2)),a[b]!==c&&(a[b]=c)),c},r.calculate=function(a,b,c){return r.valueSaver(a,b,r.minMaxRoundGrade(r.makeFunc(c)(a),1,6,"round",.1))},r.minMaxRoundGrade=function(a,b,c,d,e){return Math.max(b,Math.min(c,Math[d](a*(1/e))*e))},r.grade=function(a,b,c,d,e,f){return r.minMaxRoundGrade(a/b*(d-c)+c,c,d,e,f)},r.avgTotalStudent=function(a){var b=r.students.data.reduce(function(b,c){return""===c[a]||isNaN(c[a])||(b.total+=c[a],b.count++),b},{total:0,count:0});return b.total/b.count},r.avg=function(a){var b=0,c=0;for(var d in r.scores)c++,b+=a(r.scores[d]);for(d in r.unmatched)c++,b+=a(r.unmatched[d]);return(b/c).toFixed(2)},r.avgTotal=function(){return r.avg(function(a){return a.total})},r.avgQuestion=function(a){return r.avg(function(b){return b.questions[a]})},r.test={getter:function(a){return r.scores.hasOwnProperty(a)?r.scores[a].total:void 0},minGrade:1,maxGrade:6,roundingFormula:"round",roundingUnit:.1},r.dataTable=function(a){var b=[[],[],[],[],[]];if(r.students.data.length<=0)return b;for(var c=a.variable-5;c<=5+parseInt(a.variable);c++){for(var d={count:0,total:0,pass:0,remed:0,fail:0},e=0;e<r.students.data.length;e++){var f=a.formula.getter(r.students.data[e].id);if(!isNaN(f)){var g=r.grade(f,c,a.formula.minGrade,a.formula.maxGrade,a.formula.roundingFormula,a.formula.roundingUnit);g>=4?d.pass++:g>=3.5?d.remed++:d.fail++,d.total+=g,d.count++}}b[0].push(c),b[1].push(d.total/d.count),b[2].push(d.pass/d.count*100),b[3].push(d.remed/d.count*100),b[4].push(d.fail/d.count*100)}r.table=b};var t,u=this;c.get(f.URL+"/project/"+e.project+"/gradefiles").success(function(a){u.files=a||[]}),u.save=function(){c.post(f.URL+"/project/"+e.project+"/gradefiles",r.files)},this.makeFunc=function(a){return new Function("row","try{ return "+a+'; } catch (e) { return "error"; }')},this.lookup=function(a,b,c){var d=this.makeFunc(b)(a),e=[];if(d){var f=this.makeFunc(c);r.students.data.forEach(function(a){f(a)===d&&e.push(a.id)})}return e},this.demoStudent=function(a){return u.makeFunc(a.studentLookup)(u.getStudentById(parseInt(a.demoid)))},this["import"]=function(a){var b=this.makeFunc(a.studentLookup),c=this.makeFunc(a.fileLookup),d=[];for(var e in a.meta.selected){var f=a.meta.fields[e];d.push(f),r.students.fields.indexOf(f)<0&&r.students.fields.push(f)}a.data.forEach(function(a){var e=c(a);e&&u.students.data.forEach(function(c){b(c)===e&&d.forEach(function(b){c[b]=a[b]})})}),r.tabIndex=0},this.removeFile=function(a){u.files.splice(u.files.indexOf(a),1),u.save()},t=document.getElementById("dropbox"),t.addEventListener("dragenter",k,!1),t.addEventListener("dragover",m,!1),t.addEventListener("dragleave",l,!1),t.addEventListener("drop",n,!1)}]),angular.module("grademanagerApp").controller("OptionsCtrl",["$scope","$stateParams","$http","$mdToast","auth","API",function(a,b,c,d,e,f){var g=this;f.loadProject(b.project),g.options=f.options,g.types=["none","circle","mark","box"],g.colors=["#000000","#ff0000","#00ff00","#0000ff"],g.downloadURL=f.URL+"/project/"+b.project+"/zip?token="+e.getToken(),g.downloadODSURL=f.URL+"/project/"+b.project+"/ods?token="+e.getToken(),g.downloadCSVURL=f.URL+"/project/"+b.project+"/static/students.csv?token="+e.getToken(),g.resetLockURL=f.URL+"/project/"+b.project+"/reset/lock?token="+e.getToken(),g.saveOptions=function(){f.saveOptions(g.options.options).success(function(){d.show(d.simple().content("Options saved!").position("top right"))})},a.$watch("ctrl.options.users",function(a,c){var d=c.filter(function(b){return a.indexOf(b)<0});d.forEach(function(a){a!==e.getUsername()?f.removeUser(a,b.project):g.options.users.push(e.getUsername())});var h=a.filter(function(a){return c.indexOf(a)<0});h.forEach(function(a){a!==e.getUsername()&&f.addUser(a,b.project)})},!0)}]),angular.module("grademanagerApp").controller("ProgressDialogCtrl",["$mdDialog","API",function(a,b){var c=this;c.api=b,c.closeDialog=function(){a.hide()}}]),angular.module("grademanagerApp").controller("PromptDialogCtrl",["$mdDialog","options",function(a,b){var c=this;c.options=b,c.closeDialog=function(){a.cancel()},c.saveDialog=function(){a.hide(c.options.value)}}]),angular.module("grademanagerApp").controller("CodeEditorCtrl",["$mdDialog","$timeout","code",function(a,b,c){var d=this;d.code=c,d.options=function(){return{mode:c.mode,lineNumbers:c.numbers,viewportMargin:1/0,matchBrackets:!0,autoCloseBrackets:!0,autoCloseTags:!0,matchTags:{bothTags:!0}}},b(function(){d.load=!0},500),d.closeDialog=function(){a.hide()}}]),angular.module("grademanagerApp").controller("EditPreviewCtrl",["$mdDialog","API","$stateParams","auth","$sce",function(a,b,c,d,e){var f=this;f.api=b,f.previewSrc=function(){return e.trustAsUrl(b.URL+"/project/"+c.project+"/static/out/out.pdf?token="+d.getToken())},f.getErr=function(){return f.api.logs&&f.api.logs.preview?f.api.logs.preview.log.match(/ERR(?::|>).*/g):void 0},f.getWarn=function(){return f.api.logs&&f.api.logs.preview?f.api.logs.preview.log.match(/pdfTeX warning.*/g):void 0},f.getFull=function(){return f.api.logs&&f.api.logs.preview?f.api.logs.preview.log.match(/(?:Over|Under)full.*/g):void 0},f.logOptions={lineNumbers:!1,lineWrapping:!1,viewportMargin:1/0,readOnly:!0},f.closeDialog=function(){a.hide()}}]),angular.module("grademanagerApp").controller("GraphicsManagerCtrl",["$scope","$timeout","$mdDialog","$stateParams","$http","API","exam","Upload",function(a,b,c,d,e,f,g,h){function i(){var a=[];for(var b in j.examService.exam.graphics)j.examService.exam.graphics.hasOwnProperty(b)&&-1===j.uploads.indexOf(j.examService.exam.graphics[b])&&a.push(j.examService.exam.graphics[b]);a.sort(function(a,b){return a.name>b.name?1:-1}),j.graphics=j.uploads.slice(0).concat(a)}var j=this;j.examService=g,j.uploads=[],j.graphics=[],j.progress={},j.deleteGraphics=function(a){j.examService.deleteGraphics(a),j.uploads.indexOf(a)>-1&&j.uploads.splice(j.uploads.indexOf(a),1),i()},e.get(f.URL+"/project/"+d.project+"/graphics/sync").success(function(a){a.forEach(function(a){var b=a.replace(/(.*)\..*?$/,"$1");if(g.exam.hasOwnProperty("graphics")||(g.exam.graphics={}),!g.exam.graphics.hasOwnProperty(b)){var c=g.createGraphics();c.name=a,c.id=b,g.addGraphics(c)}})}),a.$watch("ctrl.files",function(){function a(a){var c=g.getGraphicsByName(a.name);c||(c=g.createGraphics(),c.name=a.name);var e=j.uploads.indexOf(c);e>-1&&j.uploads.splice(e,1),j.uploads.unshift(c),j.progress[c.id]=a,i(),h.upload({url:f.URL+"/project/"+d.project+"/upload/graphics",file:a,fields:{id:c.id}}).progress(function(b){a.progress=100*b.loaded/b.total*.8,console.log(a.progress)}).success(function(){b(function(){a.progress=100,g.addGraphics(c)})})}if(j.files&&j.files.length)for(var c=j.files.slice(0),e=0;e<c.length;e++)a(c[e])}),a.$watch("ctrl.examService.exam.graphics",i,!0),j.insertGraphics=function(a){c.hide(a.id)},j.closeDialog=function(){c.cancel()}}]),angular.module("grademanagerApp").directive("panZoom",["$window","$timeout",function(a,b){return{restrict:"A",link:function(c,d){c.preview.rotate=!0,b(function(){var b=svgPanZoom(d[0],{controlIconsEnabled:!0,panEnabled:!0,zoomEnabled:!0,minZoom:.5,maxZoom:10});angular.element(a).bind("resize",function(){b.resize(),b.fit(),b.center(),c.$apply()})})}}}]),function(a){a.commands.insertCode={exec:function(a,b,c){c='<code id="code'+GUID()+'"></code>',b="insertHTML",a.commands.support(b)?a.doc.execCommand(b,!1,c):a.selection.insertHTML(c)},state:function(){return!1}}}(wysihtml5),angular.module("grademanagerApp").directive("myRichTextEditor",["$timeout","$mdDialog","exam",function(a,b,c){var d={77:["formatInline","tt"],76:["formatInline","var"]},e=function(a,b){a=a.replace(/<b>\s*<\/b>/g,""),a=a.replace(/<i>\s*<\/i>/g,""),a=a.replace(/<tt>\s*<\/tt>/g,""),a=a.replace(/<var>\s*<\/var>/g,""),a=a.replace(/(<code.*?>).*?(<\/code>)/g,"$1$2");var c=document.createElement("div");c.innerHTML=a;for(var d=c.getElementsByTagName("B"),e=0;e<d.length;e++)d[e].innerHTML=d[e].innerHTML.replace(/\r?\n/g," ");for(d=c.getElementsByTagName("I"),e=0;e<d.length;e++)d[e].innerHTML=d[e].innerHTML.replace(/\r?\n/g," ");for(d=c.getElementsByTagName("TT"),e=0;e<d.length;e++)d[e].innerHTML=d[e].innerHTML.replace(/\r?\n/g," ");return wysihtml5.dom.parse(c.innerHTML,b)};return{restrict:"E",replace:!0,require:"?ngModel",transclude:!0,templateUrl:"views/myrichtexteditor.html",scope:{content:"=ngModel"},link:function(f,g,h,i){function j(b){u[b.id]=f.$watch("examService.exam.graphics['"+b.id+"']",function(){a(function(){l(),p&&(t.style.width=p.offsetWidth+"px")})},!0)}function k(b){u[b.id]=f.$watch("examService.exam.codes['"+b.id+"']",function(){a(function(){l()})},!0)}function l(){var a=s;o&&(a=o.composer.editableArea);for(var b=a.getElementsByTagName("img"),d=0;d<b.length;d++){var e=b[d],f=c.getGraphics(e.getAttribute("id"));f?(u.hasOwnProperty(f.id)||j(f),e.setAttribute("src",c.graphicsPreviewURL(f.id)),e.classList.toggle("border",f.border),e.classList.toggle("options",f.options),e.style.width=100*f.width+"%"):e.setAttribute("src",c.graphicsPreviewURL(""))}for(var g=a.getElementsByTagName("code"),h=0;h<g.length;h++){var i=g[h];i.classList.add("wysihtml5-uneditable-container");var l=c.getCode(i.getAttribute("id"),!0);i.classList.toggle("border",l.border);var m;0===i.children.length?(m=CodeMirror(i,{viewportMargin:1/0,value:l.content||"\n",lineNumbers:l.numbers,mode:l.mode,readOnly:"nocursor"}),u.hasOwnProperty(l.id)||k(l)):(m=i.children[0].CodeMirror,m.setOption("lineNumbers",l.numbers),m.setOption("mode",l.mode),m.setValue(l.content));
}}function m(a){return"CODE"===a.tagName?a:a.parentElement?m(a.parentElement):void 0}function n(){o=new wysihtml5.Editor(r,{autoLink:!1,toolbar:q,parserRules:wysihtml5ParserRules,parser:e,contentEditableMode:!0,useLineBreaks:!1,stylesheets:["styles/wysihtml5_custom.css"]}),wysihtml5.dom.observe(o.composer.editableArea,"keydown",function(a){var b=d[a.keyCode];(a.ctrlKey||a.metaKey)&&!a.altKey&&b&&(o.composer.commands.exec.apply(o.composer.commands,b),a.preventDefault())}),f.closeGraphicsToolbar=function(){t.classList.add("hide")},f.showGraphicsSettings=function(a,c){b.show({clickOutsideToClose:!1,targetEvent:a,templateUrl:"views/promptdialog.html",controller:"PromptDialogCtrl",controllerAs:"ctrl",locals:{options:{title:"Advanced options",content:"Provide LaTeX includegraphics options overrides:",label:"options",value:c.options}}}).then(function(a){c.options=a})},a(function(){o.composer.editableArea.addEventListener("click",function(a){if("IMG"===a.target.tagName){var d=a.target;t.classList.remove("hide"),t.style.top=d.offsetTop+"px",t.style.left=d.offsetLeft+"px",t.style.width=d.offsetWidth+"px",f.graphics=c.getGraphics(d.getAttribute("id")),p=d,f.$apply()}var e=m(a.target);if(e){var g=c.getCode(e.getAttribute("id"));b.show({clickOutsideToClose:!1,targetEvent:a,templateUrl:"views/codeeditor.html",controller:"CodeEditorCtrl",controllerAs:"ctrl",locals:{code:g}})}})}),o.on("focus",function(){q.classList.remove("hide")}),o.on("blur",function(){q.classList.add("hide"),t.classList.add("hide")}),o.on("change",function(){a(function(){console.log("change"),i.$setViewValue(o.getValue(!0))})}),o.on("paste",function(){a(l)}),o.on("aftercommand:composer",function(){a(l)}),o.on("change_view",function(){a(l)}),q.classList.remove("hide"),r.classList.remove("hide"),g[0].removeChild(s),s=null,o.setValue(i.$viewValue||""),a(function(){o.focus()})}var o,p,q=g.children()[0],r=g.children()[1],s=g.children()[2],t=g.children()[3],u={};f.examService=c,f.showGraphicsManager=function(c){b.show({clickOutsideToClose:!0,templateUrl:"views/graphicsmanager.html",targetEvent:c,controller:"GraphicsManagerCtrl",controllerAs:"ctrl"}).then(function(b){wysihtml5.commands.insertImage.exec(o.composer,"insertImage",{id:b}),a(l)})},i.$render=function(){var b=i.$viewValue||"";s&&(s.innerHTML=b),o&&o.setValue(b),a(l)},s.addEventListener("click",n,!1)}}}]),angular.module("grademanagerApp").directive("myPdfViewer",function(){return{template:'<div class="pdfViewer"></div>',restrict:"E",scope:{src:"@pdf",viewer:"="},link:function(a,b){PDFJS.disableStream=!0;var c=b[0],d=new PDFJS.PDFViewer({container:c});a.viewer=d,c.addEventListener("pagesinit",function(){d.currentScaleValue="page-width"}),c.addEventListener("scroll",function(){a.$apply()}),a.$watch("src",function(a){a&&PDFJS.getDocument(a).then(function(a){d.setDocument(a)})})}}}),angular.module("grademanagerApp").directive("stringToNumber",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){return""+a}),d.$formatters.push(function(a){return parseFloat(a,10)})}}}),angular.module("grademanagerApp").service("API",["$injector","$http","$timeout","$rootScope","$mdDialog","$mdToast",function(a,b,c,d,e,f){function g(){return a.get("auth")}var h=this;h.URL="https://amcui.ig.he-arc.ch",h.SOCKET_URL="https://amcui.ig.he-arc.ch/",h.project=!1,h.options={users:[],options:{},status:{}},h.connected={},h.logs={},h.sortedLogs=[],h.projects=[],h.getProjectList=function(){return b.get(h.URL+"/project/list").success(function(a){a.sort(function(a,b){return a.project>b.project?1:-1}),h.projects=a.map(function(a){return a["short"]=a.project.split("-")[0],a})})},h.createProject=function(a){return b.post(h.URL+"/project/create",{project:a})},h.newLog=function(a){return h.logs[a]={msg:a,log:"",err:"",progress:0,start:new Date},h.sortedLogs.unshift(h.logs[a]),h.logs[a]},h.getLog=function(a){return h.logs.hasOwnProperty(a)||h.newLog(a),h.logs[a]},h.getDownloadZipURL=function(){return h.URL+"/project/"+h.project+"/zip/pdf?token="+g().getToken()},h.getAnnotateZipURL=function(){return h.URL+"/project/"+h.project+"/zip/annotate?token="+g().getToken()},h.getStaticFileURL=function(a){return h.URL+"/project/"+h.project+"/static/"+a+"?token="+g().getToken()},h.loadTemplate=function(a){return b.post(h.URL+"/project/"+h.project+"/copy/template",{template:a})},h.loadProject=function(a){if(h.project!==a){Raven&&(Raven.setUserContext({id:g().getUsername()}),Raven.setExtraContext({project:a})),h.project=a,h.PROJECT_URL=h.URL+"/project/"+h.project,h.newLog("connecting"),h.socket=io.connect(h.SOCKET_URL+"?token="+g().getToken()),h.loadOptions(),h.socket.on("connect",function(){var a=h.getLog("connecting");a.end=new Date,a.progress=1}),h.socket.on("connect_error",function(){var a=h.getLog("connecting");a.end=new Date,a.progress=1,a.code=1,a.err="Socket connection error, retrying, check firewall.",h.options.status.locked=0,h.showProgressDialog()}),h.socket.on("reconnect_failed",function(a){f.show(f.simple().content("Error reconnecting socket!").position("top right")),console.log("socket error:",a)}),h.socket.on("user:online",function(a){h.connected=a,d.$apply()}),h.socket.on("user:connected",function(a){h.connected[a.id]=a,d.$apply()}),h.socket.on("user:disconnected",function(a){delete h.connected[a.id],d.$apply()}),h.socket.on("update:options",function(a){h.options.options=a,d.$apply()});var b;h.socket.on("log",function(a){if("start"===a.action?(b=h.newLog(a.msg),b.command=a.command,b.params=a.params,"getimages"===a.command&&h.showProgressDialog()):b=h.getLog(a.msg),"log"===a.action){var c=/===<.*?>=\+(.*)/g,e=c.exec(a.data);e?b.progress+=parseFloat(e[1]):(b.log+=a.data+"\n","prepare"===a.command&&(b.progress+=.001),"prepare"===a.command&&(b.progress+=.01))}"err"===a.action&&(h.logs[a.msg].err+=a.data),"end"===a.action&&(b.code=a.code,b.progress=1,b.end=new Date,a.code>0&&(h.options.status.locked=0,"preview"!==a.msg&&h.showProgressDialog())),d.$apply()});var c;h.socket.on("print",function(a){if("start"===a.action&&(h.sortedLogs=[],h.logs={},c=new Date,h.options.status.locked=1,h.options.status.printed=void 0,h.showProgressDialog()),"end"===a.action){var b={start:c,end:new Date,command:"print",msg:"printing done",log:a.pdfs.join("\n"),progress:1};h.sortedLogs.unshift(b),h.logs["printing done"]=b,h.options.status.locked=0,h.options.status.printed=(new Date).getTime()}d.$apply()});var e;h.socket.on("annotate",function(a){if("start"===a.action&&(h.sortedLogs=[],h.logs={},e=new Date,h.options.status.locked=1,h.options.status.annotated=void 0,h.showProgressDialog()),"end"===a.action){var b={start:e,end:new Date,command:"print",msg:"annotating done",log:"",type:a.type,file:a.file,progress:1};h.sortedLogs.unshift(b),h.logs["annotating done"]=b,h.options.status.locked=0,h.options.status.annotated=(new Date).getTime()}d.$apply()}),h.socket.emit("listen",h.project)}},h.showProgressDialog=function(){e.show({clickOutsideToClose:!1,escapeToClose:!1,hasBackdrop:!0,templateUrl:"views/progressdialog.html",controller:"ProgressDialogCtrl",controllerAs:"ctrl"})},h.loadOptions=function(){b.get(h.URL+"/project/"+h.project+"/options").success(h.handleOptions)},h.handleOptions=function(a){h.options.users=a.users||[],h.options.users.sort(),h.options.options=a.options||{},h.options.status=a.status||{},h.options.status.locked>0&&h.showProgressDialog()},h.saveOptions=function(a){return a||(a=h.options.options),b.post(h.URL+"/project/"+h.project+"/options",{options:a})},h.deleteGraphics=function(a){return b.post(h.URL+"/project/"+h.project+"/graphics/delete",{id:a.id,filename:a.name})},h.preview=function(a){return b.post(h.URL+"/project/"+h.project+"/preview",a)},h.print=function(a){return b.post(h.URL+"/project/"+h.project+"/print",a).error(function(a){f.show(f.simple().content(a).position("top right"))})},h.copyProject=function(a,c){return b.post(h.URL+"/project/"+a+"/copy/project",{project:c}).error(function(a){f.show(f.simple().content(a).position("top right"))})},h.copyGraphics=function(a,c){return b.post(h.URL+"/project/"+a+"/copy/graphics",{project:c}).error(function(a){f.show(f.simple().content(a).position("top right"))})},h.addUser=function(a,c){return b.post(h.URL+"/project/"+c+"/add",{username:a})},h.removeUser=function(a,c){return b.post(h.URL+"/project/"+c+"/remove",{username:a})},h.setZoneManual=function(a,c){return b.post(h.URL+"/project/"+a+"/capture/setmanual",c)},h.setPageAuto=function(a,c){return b.post(h.URL+"/project/"+a+"/capture/setauto",c)}}]),angular.module("grademanagerApp").factory("authInterceptor",["$injector","$q",function(a,b){return{request:function(b){var c=a.get("auth"),d=a.get("API"),e=c.getToken();return 0===b.url.indexOf(d.URL)&&e&&(b.headers.Authorization="Bearer "+e),b},response:function(b){var c=a.get("auth"),d=a.get("API");return 0===b.config.url.indexOf(d.URL)&&b.data.token&&c.saveToken(b.data.token),b},responseError:function(c){if(c&&401===c.status){var d=a.get("auth");d.logout()}return b.reject(c)}}}]),angular.module("grademanagerApp").service("auth",["$window","API","$http",function(a,b,c){var d=this;d.parseJwt=function(b){var c=b.split(".")[1],d=c.replace("-","+").replace("_","/");return JSON.parse(a.atob(d))},d.saveToken=function(b){a.localStorage.setItem("jwtToken",b)},d.getToken=function(){return a.localStorage.getItem("jwtToken")},d.isAuthed=function(){var a=d.getToken();if(a){var b=d.parseJwt(a);return Math.round((new Date).getTime()/1e3)<=b.exp}return!1},d.getUsername=function(){var a=d.getToken();if(a){var b=d.parseJwt(a);return b.username}return""},d.login=function(a,d){return c.post(b.URL+"/login",{username:a,password:d})},d.logout=function(){a.localStorage.removeItem("jwtToken")}}]),angular.module("grademanagerApp").service("exam",["$rootScope","$mdDialog","API","auth",function(a,b,c,d){function e(a,b,c){for(var d;null!==(d=a.exec(b));)d.index===a.lastIndex&&a.lastIndex++,c(d)}function f(a){return a=a.replace(/\\(?:textbf|bf){([\s\S]*?)}/g,"<b>$1</b>"),a=a.replace(/\\(?:textit|emph){([\s\S]*?)}/g,"<i>$1</i>"),a=a.replace(/\\newline/g,"<p>&nbsp;</p>")}function g(a){e(/AMCsection{(.*?)}([\s\S]*?)\\restituegroupe{(.*?)}/g,a,function(a){var b=r.newSection();b.title=a[1],b.level=0,b.isNumbered=!0,b.isSectionTitleVisibleOnAMC=!0,b.content=f(a[2]),b.questions=t[a[3]]||[],r.exam.sections.push(b)})}function h(a){t={},r.exam.course=a.match(/\\newcommand{\\ACMUImatiere}{(.*?)}/)[1],r.exam.session=a.match(/\\newcommand{\\ACMUIsession}{(.*?)}/)[1],r.exam.teacher=a.match(/\\newcommand{\\ACMUIteacher}{(.*?)}/)[1],e(/\\element{(.*?)}[\s\S]*?\\begin{(question|questionmult)}{(.*?)}([\s\S]*?)\\end{\2}/g,a,function(a){t.hasOwnProperty(a[1])||(t[a[1]]=[]);var b={id:a[3],scoring:"",points:1,answers:[]},c=a[4],d=c.match(/([\s\S]*?)\\begin{(reponses|reponseshoriz)}/);if(d){b.type="question"===a[2]?"SINGLE":"MULTIPLE",b.content=f(d[1]);var g=c.match(/\\begin{(reponses|reponseshoriz)}\[?(o?)\]?([\s\S]*)\\end{\1}/);b.layout="reponses"===g[1]?"VERTICAL":"HORIZONTAL",b.ordered="o"===g[2],e(/\\(bonne|mauvaise){([\s\S]*?)}/g,g[3],function(a){b.answers.push({id:"a"+GUID(),content:a[2],correct:"bonne"===a[1]})})}else if(d=c.match(/([\s\S]*?)\\AMCOpen/)){b.type="OPEN",b.content=f(d[1]);var h=c.match(/\\AMCOpen{(.*?)}{[\s\S]*\\bonne.*\\bareme{(\d)}/),i=h[1].match(/lines=(\d+)/);i&&(b.lines=i[1]),i=h[1].match(/dots=(\d+)/),i&&(b.dots="true"===i[1]),b.points=h[2]}t[a[1]].push(b)}),g(a)}function i(a){a=a.replace(/&nbsp;/g," ");var b={"&lt;":"<","&gt;":">","\\\\":"\\textbackslash ","&":"\\&","%":"\\%","\\$":"\\$","\\#":"\\#",_:"\\_","\\{":"\\{","\\}":"\\}","~":"\\textasciitilde ","\\^":"\\textasciicircum "};for(var c in b){var d=new RegExp(c,"g");a=a.replace(d,b[c])}return a}function j(a){var b=r.getCode(a.getAttribute("id"));if(b){var c="\\lstinputlisting[",d=[];return b.border&&d.push("frame=single"),b.numbers||d.push("numbers=none"),b.mode&&u.hasOwnProperty(b.mode)&&d.push("language="+u[b.mode]),c+=d.join(",")+"]{src/codes/"+b.id+"}"}return"CODE\\_NOT\\_FOUND"}function k(a){var b=r.getGraphics(a.getAttribute("id"));if(b){var c="width="+b.width.toFixed(2)+"\\textwidth";b.options&&(c=b.options);var d="\\includegraphics["+c+"]{src/graphics/"+b.id+"}";return b.border&&(d="\\fbox{"+d+"}"),d}return"IMG\\_NOT\\_FOUND"}function l(a){function b(a,c){if(a.hasChildNodes()){for(var d=a.childNodes,e="",f=0;f<d.length;f++){var g=d[f];switch(g.nodeName){case"#text":e+=i(g.textContent);break;case"VAR":e+=" "+g.textContent+" ";break;case"B":e+="\\textbf{"+b(g,c+1)+"}";break;case"I":e+="\\emph{"+b(g,c+1)+"}";break;case"TT":e+="\\texttt{"+b(g,c+1)+"}";break;case"IMG":e+=k(g);break;case"CODE":e+=j(g);break;case"P":g.classList.contains("wysiwyg-text-align-center")?(e+="\\begin{center}\n",e+=b(g,c+1)+"\n",e+="\\end{center}\n"):e+=b(g,c+1),a.childNodes.length>1&&(e+="\n\n");break;case"UL":e+="\\begin{itemize}\n"+b(g,c+1)+"\\end{itemize}\n";break;case"LI":e+="\\item "+b(g,c+1)+"\n";break;case"BOX":e+="\\fbox{\\parbox{\\textwidth}{\n"+b(g,c+1)+"}}\\newline\n";break;case"HR":e+="\\newpage\n"}}return e}return a.textContent}var c=document.createElement("div");return c.innerHTML=a,b(c,0)}function m(a,b){b.push("      \\"+(a.correct?"bonne":"mauvaise")+"{"+l(a.content)+"      }")}function n(a,b,c){var d="VERTICAL"===a.layout?"reponses":"reponseshoriz",e="  \\begin{"+b+"}{Q"+("00"+a.number).slice(-2)+"}";a.scoring&&(e+="\\scoring{"+a.scoring+"}"),c.push(e),c.push("\n  "+l(a.content));var f="\n    \\begin{"+d+"}";a.ordered&&(f+="[o]"),c.push(f),a.answers.forEach(function(a){m(a,c)}),c.push("    \\end{"+d+"}"),c.push("  \\end{"+b+"}")}function o(a,b){var c="  \\begin{question}{Q"+("00"+a.number).slice(-2)+"}";b.push(c),b.push("\n  "+l(a.content));var d="    \\AMCOpen{";d+="lines="+a.lines,d+=",dots="+(a.dots?"true":"false"),d+="}{",b.push(d),b.push("      \\wrongchoice[W]{0pt}\\scoring{0}");for(var e=1;e<=a.points;e++){var f="wrongchoice",g="P"+e;e===a.points&&(f="correctchoice",g="C"),b.push("      \\"+f+"["+g+"]{"+e+(e>1?"pts":"pt")+"}\\scoring{"+e+"}")}b.push("    }"),b.push("  \\end{question}")}function p(a,b,c){switch(c.push("\\element{"+a.id+"}{"),b.type){case"SINGLE":n(b,"question",c);break;case"MULTIPLE":n(b,"questionmult",c);break;case"OPEN":o(b,c)}c.push("}")}function q(a,b,c){if(a.questions.forEach(function(c){p(a,c,b)}),a.pageBreakBefore&&c.push("\\newpage"),""!==a.title){var d="\n\\";a.isSectionTitleVisibleOnAMC&&(d+="AMC"),d+=new Array(parseInt(a.level)+1).join("sub")+"section",a.isNumbered||(d+="*"),d+="{"+l(a.title)+"}\n",c.push(d)}if(c.push(l(a.content)),a.questions.length>0){a.shuffle&&c.push("\\melangegroupe{"+a.id+"}");var e=function(a){a()};a.columns>1&&(e=function(b){c.push("\\begin{multicols}{"+a.columns+"}"),b(),c.push("\\end{multicols}")}),e(function(){c.push("\\restituegroupe{"+a.id+"}")})}}var r=this,s=diffsync.Client;r.preview=function(){var a=r.toLatex();a.source=r.exam.source,a.codes=r.exam.codes,c.preview(a)},r.print=function(){function a(){var a=r.toLatex();a.source=r.exam.source,a.codes=r.exam.codes,c.print(a)}c.options.status.scanned?b.show(b.confirm().title("Warning!").content("Papers analysis was already made on the basis of the current working documents. If you modify working documents, you will not be capable any more of analyzing the papers you have already distributed!").ok("Print & Overwrite").cancel("Cancel")).then(a):a()},r.load=function(b){var d=c.newLog("loading exam"),e=new s(c.socket,c.project);e.on("connected",function(){r.exam=e.getData(),b(e),d.end=new Date,d.progress=1,a.$apply()}),e.on("synced",function(){a.$apply()}),e.on("error",function(a){console.log("error",a)}),e.initialize()},r.loadTemplate=function(a){c.loadTemplate(a).success(function(a){r.exam&&(r.exam.source=a)})},r.newSection=function(){return{id:"s"+GUID(),title:"Add Section",content:"<p></p>",level:0,isNumbered:!0,isSectionTitleVisibleOnAMC:!0,shuffle:!1,columns:1,pageBreakBefore:!1,questions:[]}},r.getSection=function(a){for(var b=0;b<r.exam.sections.length;b++)if(r.exam.sections[b].id===a)return r.exam.sections[b]},r.addQuestion=function(a){var b;a.questions&&a.questions.length>0&&(b=a.questions[a.questions.length-1]);var c={id:"q"+GUID(),content:"<p></p>",type:"SINGLE",layout:"VERTICAL",ordered:!1,scoring:"",points:1,dots:!1,lines:3,answers:[]};return b&&(c.type=b.type),"OPEN"!==c.type&&(r.addAnswer(c),r.addAnswer(c)),a.questions.push(c),c},r.copyQuestion=function(a,b){var c=r.addQuestion(a);return c.content=b.content,c.type=b.type,c.layout=b.layout,c.ordered=b.ordered,c.scoring=b.scoring,c.points=b.points,c.dots=b.dots,c.lines=b.lines,c.answers=[],b.answers.forEach(function(a){r.copyAnswer(c,a)}),c},r.removeQuestion=function(a,b){a.questions.splice(a.questions.indexOf(b),1)},r.addAnswer=function(a){var b={id:"a"+GUID(),content:"<p></p>",correct:!1};return a.answers.push(b),b},r.copyAnswer=function(a,b){var c=r.addAnswer(a);return c.content=b.content,c.correct=b.correct,c},r.removeAnswer=function(a,b){a.answers.splice(a.answers.indexOf(b),1)},r.createGraphics=function(){return{id:"g"+GUID(),border:!1,width:.7,name:""}},r.addGraphics=function(a){r.exam.graphics||(r.exam.graphics={}),r.exam.graphics[a.id]=a},r.deleteGraphics=function(a){c.deleteGraphics(a).success(function(){delete r.exam.graphics[a.id]})},r.addCode=function(a){var b={id:a,border:!0,mode:"",numbers:!1,content:""};return r.exam.codes||(r.exam.codes={}),r.exam.codes[b.id]=b,b},r.getCode=function(a,b){return r.exam&&r.exam.codes&&r.exam.codes.hasOwnProperty(a)?r.exam.codes[a]:b?r.addCode(a):void 0},r.computeHierarchyNumbers=function(){for(var a=1,b=[0,0,0],c=0;c<r.exam.sections.length;c++){var d=r.exam.sections[c];if(d.isNumbered){for(var e="",f=0;3>f;f++)if(parseInt(d.level)===f&&b[f]++,f>0&&(e+="."),e+=b[f],parseInt(d.level)===f){for(var g=f+1;3>g;g++)b[g]=0;d.number=e;break}}else d.number="";for(var h=0;h<d.questions.length;h++){var i=d.questions[h];i.number=a,a++,i.isValid=("OPEN"===i.type?!0:i.answers.length>0)&&("SINGLE"===i.type?1===i.answers.reduce(function(a,b){return a+b.correct},0):!0)}}},r.graphicsPreviewURL=function(a){return c.PROJECT_URL+"/static/src/graphics/"+a+"_thumb.jpg?token="+d.getToken()},r.getJSON=function(){return JSON.stringify(angular.copy(r.exam),null,2)},r.getGraphics=function(a){return r.exam&&r.exam.graphics&&r.exam.graphics.hasOwnProperty(a)?r.exam.graphics[a]:void 0},r.getGraphicsByName=function(a){if(r.exam&&r.exam.graphics)for(var b in r.exam.graphics)if(r.exam.graphics[b].name===a)return r.exam.graphics[b]};var t={};r.importLatex=function(a){h(a)};var u={"text/html":"html","text/css":"html","text/javascript":"JavaScript","text/x-sql":"SQL"};r.toLatex=function(){var a=[],b=[];return r.exam&&r.exam.sections&&(a.push("\\newcommand{\\ACMUImatiere}{"+l(r.exam.course||"")+"}"),a.push("\\newcommand{\\ACMUIsession}{"+l(r.exam.session||"")+"}"),a.push("\\newcommand{\\ACMUIteacher}{"+l(r.exam.teacher||"")+"}\n"),r.exam.sections.forEach(function(c){q(c,a,b)})),{questions_definition:a.join("\n"),questions_layout:b.join("\n")}}}]),angular.module("grademanagerApp").filter("htmlToPlaintext",function(){return function(a){return String(a).replace(/<[^>]+>/gm,"").replace(/&nbsp;/gm," ")}}),angular.module("grademanagerApp").filter("join",function(){return function(a,b){return angular.isArray(a)?a.join(b):a}}),angular.module("grademanagerApp").filter("unique",function(){return function(a,b){if(b===!1)return a;if((b||angular.isUndefined(b))&&angular.isArray(a)){var c=[],d=function(a){return angular.isObject(a)&&angular.isString(b)?a[b]:a};angular.forEach(a,function(a){for(var b=!1,e=0;e<c.length;e++)if(angular.equals(d(c[e]),d(a))){b=!0;break}b||c.push(a)}),a=c}return a}}),angular.module("grademanagerApp").run(["$templateCache",function(a){"use strict";a.put("views/association.html",'<md-dialog aria-label="Manual association"> <form> <md-toolbar> <div class="md-toolbar-tools"> <h2>Manual Association</h2> <span flex></span> <md-button class="md-icon-button" ng-click="ctrl.closeDialog()"> <md-icon class="mdi-close" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div ng-show="ctrl.match"> <md-autocomplete placeholder="Student name" md-no-cache="true" md-selected-item-change="ctrl.selectedItemChange(item)" md-search-text="searchText" md-items="item in ctrl.students.data.filter(ctrl.filterUnmatched) | filter: searchText" md-item-text="item.display"> <md-item-template> <span md-highlight-text="searchText" md-highlight-flags="^i">{{item.name}}</span> </md-item-template> <md-not-found> No matches found for "{{searchText}}". </md-not-found> </md-autocomplete> <img ng-src="{{ctrl.nameSrc()}}"> </div> <div ng-hide="ctrl.match"> Everything has a match. </div> </md-dialog-content> <div class="md-actions" layout="row"> <span flex></span> <md-button ng-click="ctrl.closeDialog()" class="md-primary"> close </md-button> </div> </form></md-dialog>'),a.put("views/codeeditor.html",'<md-dialog aria-label="code editor" class="code-editor" flex="80"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Code editing</h2> <span flex></span> <md-button class="md-icon-button" ng-click="ctrl.closeDialog()"> <md-icon class="mdi-close" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content layout="column"> <div layout="row" layout-align="start center" class="section-options" layout-wrap> <md-select placeholder="Mode" ng-model="ctrl.code.mode" class="md-primary"> <md-option ng-repeat="mode in [\'text/html\', \'text/css\', \'text/javascript\', \'text/x-sql\']" value="{{mode}}">{{mode}}</md-option> </md-select> <md-checkbox class="md-primary" ng-model="ctrl.code.numbers">Line numbers</md-checkbox> <md-checkbox class="md-primary" ng-model="ctrl.code.border">Border</md-checkbox> </div> <md-content flex ng-class="{\'border\': ctrl.code.border}" layout="column"> <ui-codemirror flex ng-if="ctrl.load" ui-codemirror-opts="ctrl.options()" ng-model="ctrl.code.content"></ui-codemirror> </md-content> </md-dialog-content> <div class="md-actions" layout="row"> <span flex></span> <md-button ng-click="ctrl.closeDialog()" class="md-primary"> close </md-button> </div> </md-dialog>'),a.put("views/edit.html",'<div ng-if="!editor.section" flex layout-align="start center" layout="column"> <h1>Loading...</h1> <md-progress-linear md-mode="indeterminate"></md-progress-linear> </div> <div layout="row" flex class="no-background" ng-if="editor.section"> <md-sidenav class="md-sidenav-left md-whiteframe-z2" md-component-id="left" md-is-locked-open="$mdMedia(\'gt-lg\')" layout="column"> <md-toolbar class="md-accent md-whiteframe-z1" layout="row"> <div class="md-toolbar-tools"> <h3>{{editor.examService.exam.course}} - {{editor.examService.exam.session}}</h3> </div> </md-toolbar> <div flex class="scroll-frame"> <md-content layout-padding class="scroll-section"> <div class="section-options" hide show-sm layout-padding> <md-button aria-label="print" class="md-warn" ng-click="editor.examService.print()">Print</md-button> <md-input-container> <label>course</label> <input ng-model="editor.examService.exam.course"> </md-input-container> <md-input-container> <label>session</label> <input ng-model="editor.examService.exam.session"> </md-input-container> <md-input-container> <label>teacher</label> <input ng-model="editor.examService.exam.teacher"> </md-input-container> </div> <div ui-tree="editor.examMenuOptions"> <ol ui-tree-nodes="" ng-model="editor.examService.exam.sections" data-type="section"> <li class="section-menu" ng-repeat="section in editor.examService.exam.sections track by section.id" ng:init="parentIndex = $index" ui-tree-node> <div ui-tree-handle layout="row" ng-class="{\'active\': section == editor.section}"> <p ng-if="editor.copyMode"><md-checkbox ng-model="editor.copyCheckbox[section.id]" ng-change="editor.toggleCopy(section)" class="md-primary" data-nodrag>{{section.number}} {{section.title}}</md-checkbox></p> <p ng-if="!editor.copyMode">{{section.number}} {{section.title}}</p> <span flex></span> <md-button aria-label="select section" data-nodrag ng-href="{{editor.linkToQuestion(section)}}" class="md-icon-button"><md-icon class="mdi-eye"></md-icon></md-button> </div> <ol ui-tree-nodes="" ng-model="section.questions" data-type="question"> <li class="question-menu" ng-repeat="question in section.questions track by question.id" ui-tree-node> <div ui-tree-handle layout="row"> <div flex> <strong layout-align="start center"> <md-checkbox ng-model="editor.copyCheckbox[question.id]" ng-change="editor.toggleCopy(section, question)" ng-if="editor.copyMode" class="md-primary" data-nodrag> <md-icon class="mdi-alert invalid" ng-hide="question.isValid"></md-icon> Question {{question.number}} <span ng-show="question.type == \'MULTIPLE\'"></span> </md-checkbox> <div ng-if="!editor.copyMode"><md-icon class="mdi-alert invalid" ng-hide="question.isValid"></md-icon> Question {{question.number}} <span ng-show="question.type == \'MULTIPLE\'"></span></div> </strong> <em>{{question.content | htmlToPlaintext | limitTo: 50}}</em> </div> <md-button aria-label="select section" data-nodrag ng-href="{{editor.linkToQuestion(section, question)}}" class="md-icon-button"><md-icon class="mdi-eye"></md-icon></md-button> </div> </li> </ol> </li> </ol> </div> <md-divider></md-divider> <div> <md-switch class="md-primary" ng-model="editor.copyMode" ng-change="editor.API.getProjectList()" aria-label="copy mode"> Activate copy </md-switch> <div ng-if="editor.copyMode"> <p>{{editor.copySummary().questions}} question(s) in {{editor.copySummary().sections}} section(s).</p> <p layout="row" layout-align="start center" layout-wrap> <md-select class="md-primary" placeholder="CopyTo" ng-model="editor.copyToName"> <md-option ng-repeat="item in editor.API.projects" value="{{item.project}}">{{item.project}}</md-option> </md-select> <md-button ng-click="editor.copyTo()" class="md-primary" ng-disabled="editor.copySummary().sections == 0 || !editor.copyTo">Copy</md-button> </p> </div> </div> </md-content> </div> </md-sidenav> <div flex class="no-background" layout="column" ng-if="editor.section"> <div ng-if="app.api.options.status.printed && !editor.hidePrintNotification" class="printed-bar" layout-padding layout="row" layout-align="center center"> This project has been printed on {{app.api.options.status.printed | date: \'yyyy-MM-dd HH:mm\'}}. <md-button class="md-raised md-primary" ng-href="{{app.api.getDownloadZipURL()}}">Download Zip with all PDFs</md-button> <span flex></span> <md-button class="md-icon-button" ng-click="editor.hidePrintNotification=true" aria-label="close message"><md-icon class="mdi-close"></md-icon></md-button> </div> <div ng-if="!editor.examService.exam.source" class="printed-bar" layout-padding layout="row" layout-align="center center"> This project\'s templace file is empty! Select a template: <md-select class="md-primary" placeholder="Template" ng-model="editor.chooseTemplate"> <md-option ng-repeat="name in [\'HEG-QCM\', \'HEG-OPEN\', \'HEC-QCM\']" value="{{name}}">{{name}}</md-option> </md-select> <md-button class="md-raised md-primary" ng-click="editor.examService.loadTemplate(editor.chooseTemplate)">Load</md-button> <span flex></span> </div> <md-content class="section-options main-toolbar md-whiteframe-z1" layout="row" layout-align="start center" layout-padding> <md-button aria-label="toggle menu" class="md-icon-button" ng-hide="editor.leftNav().isLockedOpen()" ng-click="editor.leftNav().open()"> <md-icon class="mdi-menu"></md-icon> </md-button> <div flex class="no-padding" layout="row"> <md-input-container flex hide-sm> <label>course</label> <input ng-model="editor.examService.exam.course"> </md-input-container> <md-input-container flex hide-sm> <label>session</label> <input ng-model="editor.examService.exam.session"> </md-input-container> <md-input-container flex hide-sm> <label>teacher</label> <input ng-model="editor.examService.exam.teacher"> </md-input-container> </div> <span hide-sm>{{editor.lastPreview | date: \'HH:mm:ss\'}}</span> <md-button aria-label="preview" ng-class="{\'md-warn\':  app.api.logs.preview.code>0}" ng-click="editor.showPreviewDialog($event)">{{editor.previewWait ? \'wait\' : app.api.logs.preview.code == 0 ? \'Preview\' : app.api.logs.preview.code > 0 ? \'error\' : \'compiling\'}}</md-button> <md-button aria-label="LaTeX options" class="md-primary" ng-class="{\'active\': editor.isLatexOptionVisible}" ng-click="editor.isLatexOptionVisible = !editor.isLatexOptionVisible">LaTeX options</md-button> <md-button aria-label="print" class="md-warn" ng-click="editor.examService.print()" hide-sm>Print</md-button> </md-content> <div flex ng-if="editor.isLatexOptionVisible" layout="column" class="scroll-frame"> <md-tabs flex id="latex-options" md-selected="editor.selectedSourcePreview"> <md-tab label="source.tex"> <ui-codemirror class="border" ng-if="editor.selectedSourcePreview == 0" ui-codemirror-opts="editor.latexSourceOptions" ng-model="editor.examService.exam.source"></ui-codemirror> </md-tab> <md-tab> <md-tab-label> <md-icon class="mdi-lock"></md-icon> questions_definition.tex </md-tab-label> <md-tab-body> <ui-codemirror class="border" ng-if="editor.selectedSourcePreview == 1" ui-codemirror-opts="editor.latexPreviewOptions" ng-model="editor.examService.toLatex().questions_definition"></ui-codemirror> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon class="mdi-lock"></md-icon> questions_layout.tex </md-tab-label> <md-tab-body> <ui-codemirror class="border" ng-if="editor.selectedSourcePreview == 2" ui-codemirror-opts="editor.latexPreviewOptions" ng-model="editor.examService.toLatex().questions_layout"></ui-codemirror> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon class="mdi-lock"></md-icon> data.json </md-tab-label> <md-tab-body> <ui-codemirror class="border" ng-if="editor.selectedSourcePreview == 3" ui-codemirror-opts="editor.jsonPreviewOptions" ng-init="json = editor.examService.getJSON()" ng-model="json"></ui-codemirror> </md-tab-body> </md-tab> <md-tab> <md-tab-label> import </md-tab-label> <md-tab-body> <ui-codemirror class="border" ng-if="editor.selectedSourcePreview == 4" ui-codemirror-opts="editor.latexSourceOptions" ng-model="editor.importSource"></ui-codemirror> <div layout-padding> Past AMC Latex code here (amcui layout and question definition), then <md-button ng-click="editor.examService.importLatex(editor.importSource)" class="md-raised md-primary">Import</md-button> </div> </md-tab-body> </md-tab> </md-tabs> <md-button aria-label="close" class="tab-close md-icon-button" ng-click="editor.isLatexOptionVisible = false"><md-icon class="mdi-close"></md-icon></md-button> </div> <div flex class="scroll-frame" ng-hide="editor.isLatexOptionVisible"> <md-content class="section scroll-section" layout-padding> <div class="page-width-limit"> <div class="md-whiteframe-z1"> <div class="md-whiteframe-z1" id="q0"> <div layout="row" class="section-header" layout-align="space-around center"> <md-button aria-label="previous" class="md-primary" ng-show="editor.previousSection()" ng-click="editor.section = editor.previousSection()" ng-bind="editor.previousSection().title"></md-button> <span flex></span> <h3>{{editor.section.number}}</h3> <md-input-container md-no-float> <input type="text" ng-model="editor.section.title" placeholder="Section title"> </md-input-container> <span flex></span> <md-button aria-label="next or new" class="md-primary" ng-click="editor.section = editor.nextSection(true)" ng-bind="editor.nextSection().title"></md-button> </div> <md-content layout="row" class="section-options section-nowrap" layout-align="start center"> <md-select class="md-primary" placeholder="Level" ng-model="editor.section.level"> <md-option ng-repeat="(key, value) in {\'Level 1\': 0, \'Level 2\': 1, \'Level 3\': 2}" value="{{value}}">{{key}}</md-option> </md-select> <md-checkbox class="md-primary" ng-model="editor.section.isNumbered" ng-disabled="editor.section.isSectionTitleVisibleOnAMC">Show number</md-checkbox> <md-checkbox class="md-primary" ng-model="editor.section.isSectionTitleVisibleOnAMC" ng-change="editor.section.isSectionTitleVisibleOnAMC ? editor.section.isNumbered=true : \'\'">On answer sheet</md-checkbox> <md-checkbox class="md-primary" ng-model="editor.section.shuffle">Shuffle</md-checkbox> <md-select class="md-primary" placeholder="Columns" ng-model="editor.section.columns"> <md-option ng-repeat="(key, value) in {\'One column\': 1, \'Two columns\': 2}" value="{{value}}">{{key}}</md-option> </md-select> <md-checkbox class="md-primary" ng-model="editor.section.pageBreakBefore">Page break before</md-checkbox> <span flex></span> <md-button aria-label="delete section" class="md-warn" ng-click="editor.removeSection(editor.section)"><md-icon class="mdi-delete"></md-icon></md-button> </md-content> </div> <my-rich-text-editor class="page-width-limit" ng-model="editor.section.content"></my-rich-text-editor> </div> <div ng-class="{\'two-columns\': editor.section.columns == 2}"> <div class="question md-whiteframe-z1 {{question.type}}" ng-repeat="question in editor.section.questions track by question.id"> <div> <div class="question-header" layout="row" layout-padding> <h3 id="q{{question.number}}"><md-icon class="mdi-alert invalid" ng-hide="question.isValid" title="Need answers"></md-icon> Question {{question.number}} <span ng-show="question.type == \'MULTIPLE\'"></span></h3> </div> <md-content layout="row" class="section-options section-nowrap md-whiteframe-z1" layout-align="start center"> <md-select placeholder="Type" ng-model="question.type"> <md-option ng-repeat="value in [\'SINGLE\', \'MULTIPLE\', \'OPEN\']" value="{{value}}">{{value}}</md-option> </md-select> <md-select ng-if="question.type == \'SINGLE\' || question.type == \'MULTIPLE\'" placeholder="Layout" ng-model="question.layout"> <md-option ng-repeat="(key, value) in {\'VERTICAL\': \'VERTICAL\', \'HORIZONTAL\': \'HORIZONTAL\'}" value="{{value}}">{{key}}</md-option> </md-select> <md-checkbox ng-if="question.type == \'SINGLE\' || question.type == \'MULTIPLE\'" class="md-primary" ng-model="question.ordered">Ordered</md-checkbox> <md-input-container class="question-scoring" ng-if="question.type == \'SINGLE\' || question.type == \'MULTIPLE\'"> <label>scoring</label> <input ng-model="question.scoring"> </md-input-container> <md-button aria-label="scoring help" ng-if="question.type == \'SINGLE\' || question.type == \'MULTIPLE\'" class="md-primary md-icon-button" href="http://home.gna.org/auto-qcm/auto-multiple-choice.en/graphical-interface.shtml#bareme" target="_blank"><md-icon class="mdi-help-circle"></md-icon></md-button> <md-checkbox ng-if="question.type == \'OPEN\'" class="md-primary" ng-model="question.dots">Dots</md-checkbox> <md-input-container ng-if="question.type == \'OPEN\'"> <label>lines</label> <input ng-model="question.lines" type="number" min="1"> </md-input-container> <md-input-container ng-if="question.type == \'OPEN\'"> <label>Points</label> <input ng-model="question.points" type="number" min="1"> </md-input-container> <md-button title="copy question" aria-label="copy question" class="md-primary md-icon-button" ng-click="editor.examService.copyQuestion(editor.section, question)"><md-icon class="mdi-content-copy"></md-icon></md-button> <span flex></span> <md-button aria-label="delete question" class="md-warn" ng-click="editor.examService.removeQuestion(editor.section, question)"><md-icon class="mdi-delete"></md-icon></md-button> </md-content> </div> <my-rich-text-editor ng-model="question.content"></my-rich-text-editor> <div ng-if="question.type == \'SINGLE\' || question.type == \'MULTIPLE\'" layout="{{question.layout == \'HORIZONTAL\' ? \'row\' : \'column\'}}" layout-padding layout-align="{{question.layout == \'HORIZONTAL\' ? \'center start\' : \'\'}}" ng-class="{\'answer-horizontal\': question.layout == \'HORIZONTAL\'}"> <div ng-repeat="answer in question.answers track by answer.id" class="answer" layout="row"> <md-checkbox ng-model="answer.correct" class="answer-toggle" ng-class="{\'mdi-close\': !answer.correct, \'mdi-check\': answer.correct}" aria-label="question correct"></md-checkbox> <my-rich-text-editor ng-model="answer.content" flex></my-rich-text-editor> <md-button aria-label="delete answer" class="md-warn" ng-click="editor.examService.removeAnswer(question, answer)"><md-icon class="mdi-delete"></md-icon></md-button> </div> <div class="answer" layout="row" ng-if="question.type == \'MULTIPLE\'"> <md-checkbox class="answer-toggle" ng-class="{\'mdi-close\': !editor.questionIsNoneCorrect(question), \'mdi-check\': editor.questionIsNoneCorrect(question)}" aria-label="question correct"></md-checkbox> <div flex layout-padding class="myrichtexteditor answer-none">None of the above</div> <md-button aria-label="delete answer" class="md-warn" ng-disabled="\'true\'"><md-icon class="mdi-delete"></md-icon></md-button> </div> </div> <div ng-if="question.type == \'SINGLE\' || question.type == \'MULTIPLE\'" class="section-options answer-add"> <md-button aria-label="add new answer" class="md-primary" ng-click="editor.examService.addAnswer(question)">Add Answer</md-button> </div> <div ng-if="question.type == \'OPEN\'" layout="row" layout-align="end center" class="answer-open-points"> <div class="circle" ng-class="{\'last\': $last}" ng-repeat-start="p in editor.range(1 + question.points) track by $index"></div> <div class="point" ng-repeat-end>{{$index}}{{$index > 1 ? \'pts\' : \'pt\'}}</div> </div> <div ng-if="question.type == \'OPEN\'" class="answer-open"> <p ng-class="{\'dots\': question.dots}" ng-repeat="p in editor.range(question.lines) track by $index">&nbsp;</p> </div> </div> </div> <div class="section-options md-whiteframe-z1 question-add"> <md-button aria-label="add new question" class="md-primary" ng-click="editor.examService.addQuestion(editor.section)">Add Question</md-button> </div> </div> </md-content> </div> </div> </div> <!--\r\n<md-icon class="mdi-message"></md-icon>\r\n<md-icon class="mdi-message-text"></md-icon>\r\n<md-icon class="mdi-forum"></md-icon>\r\n<md-icon class="mdi-view-list"></md-icon>\r\n<md-icon class="mdi-view-module"></md-icon>\r\n<md-icon class="mdi-settings"></md-icon>\r\n<md-icon class="mdi-eye"></md-icon>\r\n<md-icon class="mdi-format-list-numbers"></md-icon>\r\n<md-icon class="mdi-file-document"></md-icon>\r\n<md-icon class="mdi-shuffle"></md-icon>\r\n<md-icon class="mdi-dots-horizontal"></md-icon>\r\n<md-icon class="mdi-dots-vertical"></md-icon>\r\n<md-icon class="mdi-check"></md-icon>\r\n<md-icon class="mdi-close"></md-icon>\r\n<md-icon class="mdi-menu"></md-icon>\r\n<md-icon class="mdi-plus"></md-icon>\r\n<md-icon class="mdi-upload"></md-icon>\r\n<md-icon class="mdi-download"></md-icon>\r\n<md-icon class="mdi-code-tags"></md-icon>\r\n<md-icon class="mdi-printer"></md-icon>\r\n-->'),
a.put("views/edit.preview.html",'<md-dialog aria-label="Preview Document" class="edit-preview"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Preview Document</h2> <span flex></span> <md-button class="md-icon-button" ng-click="ctrl.closeDialog()"> <md-icon class="mdi-close" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content flex layout="column"> <my-pdf-viewer ng-hide="isLogVisible" ng-if="ctrl.api.logs.preview.code == 0" pdf="{{ctrl.previewSrc()}}" viewer="ctrl.pdfViewer" flex></my-pdf-viewer> <div class="latex-errors" ng-show="isLogVisible || ctrl.api.logs.preview.code != 0"> <div layout-padding> <h3>Error</h3> <div class="err" ng-repeat="err in ctrl.getErr() | unique">{{err}}</div> <h3>Warning</h3> <div class="warn" ng-repeat="err in ctrl.getWarn() | unique">{{err}}</div> <h3>Over/Underfull</h3> <div class="full" ng-repeat="err in ctrl.getFull() | unique">{{err}}</div> </div> <ui-codemirror ui-codemirror-opts="ctrl.logOptions" ng-model="ctrl.api.logs.preview.log"></ui-codemirror> </div> </md-dialog-content> <div class="md-actions" layout="row"> <span ng-if="ctrl.api.logs.preview.code == 0">{{ctrl.pdfViewer.currentPageNumber}} / {{ctrl.pdfViewer.pagesCount}}</span> <md-button class="md-primary" ng-if="ctrl.api.logs.preview.code == 0" ng-href="{{ctrl.previewSrc()}}">download</md-button> <md-button ng-click="isLogVisible = !isLogVisible">log</md-button> <span flex></span> <md-button ng-click="ctrl.closeDialog()" class="md-primary"> close </md-button> </div> </md-dialog>'),a.put("views/grade.html",'<!--\r\nThere must be at least one column named name or surname.\r\n\r\n%S\r\nis replaced by the student\'s total score.\r\n%M\r\nis replaced by the maximum total score.\r\n%s\r\nis replaced by the student\'s mark.\r\n%m\r\nis replaced by the maximum mark.\r\n%(ID)\r\nis replaced by the student\'s name.\r\n%(COL)\r\nis replaced by the value of column COL in the students list for the curent student.\r\n\r\nhighlight impossible? missing? confirm reviewed\r\n--> <div class="no-background" flex layout="column"> <div ng-if="app.api.options.status.annotated && !grade.hidePrintNotification" class="printed-bar" layout-padding layout="row" layout-align="center center"> This project has been annotaed on {{app.api.options.status.annotated | date: \'yyyy-MM-dd HH:mm\'}}. <md-button class="md-raised md-primary" ng-href="{{app.api.getAnnotateZipURL()}}">Download Zip with annotated PDFs</md-button> <span flex></span> <md-button class="md-icon-button" ng-click="grade.hidePrintNotification=true" aria-label="close message"><md-icon class="mdi-close"></md-icon></md-button> </div> <div class="section-options" layout-padding layout="column" style="position: relative"> <md-input-container style="max-height:400px" ng-hide="grade.hideAdd"> <label>Paste CSV data or drop a file</label> <textarea ng-model="grade.pasteData" id="dropbox"></textarea> </md-input-container> <div layout="row" ng-hide="grade.hideAdd"> <md-button class="md-primary" ng-click="grade.parsePasteData()">Add to Students</md-button> <md-button class="md-primary" ng-click="grade.parseAsNewFile()">Add as new file</md-button> <span flex></span> <md-button class="md-warn" ng-click="grade.export()">export</md-button> </div> <md-button ng-show="grade.hideAdd" ng-click="grade.hideAdd = !grade.hideAdd">CSV Options</md-button> <md-button ng-hide="grade.hideAdd" ng-click="grade.hideAdd = !grade.hideAdd" aria-label="close" class="md-icon-button tab-close"><md-icon class="mdi-close"></md-icon></md-button> </div> <md-tabs flex md-selected="grade.tabIndex"> <md-tab label="Students"> <section class="grades"> <div ng-if="grade.students.data.length > 0 && grade.table"> <h4>Datatable</h4> <table> <tr> <th></th> <th class="text-right" ng-repeat="c in grade.table[0] track by $index">{{c | number: 0}}</th> </tr> <tr> <th class="text-left">AVG</th> <td class="text-right" ng-repeat="c in grade.table[1] track by $index">{{c | number: 2}}</td> </tr> <tr> <th class="text-left">Pass</th> <td class="text-right" ng-repeat="c in grade.table[2] track by $index">{{c | number: 0}}%</td> </tr> <tr> <th class="text-left">Remed</th> <td class="text-right" ng-repeat="c in grade.table[3] track by $index">{{c | number: 0}}%</td> </tr> <tr> <th class="text-left">Fail</th> <td class="text-right" ng-repeat="c in grade.table[4] track by $index">{{c | number: 0}}%</td> </tr> </table> </div> <table> <thead> <tr> <th></th> <th ng-repeat="col in grade.students.fields track by $index"> <div layout="row" layout-align="start end"> <span>{{col}}</span> <md-button class="button-remove" aria-label="rename column" ng-click="grade.renameColumn($event, grade.students.fields, $index, grade.students.data)" ng-hide="col == \'id\'"><md-icon class="mdi-pencil"></md-icon></md-button> <md-button aria-label="remove column" ng-click="grade.removeCol(col)" class="md-warn button-remove" ng-hide="col == \'id\'"><md-icon class="mdi-close"></md-icon></md-button> </div> </th> <th class="text-left"> <md-input-container> <label>Final grade formula</label> <input ng-blur="app.api.saveOptions()" ng-model="app.api.options.options.final_grade_formula" ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 500, \'blur\': 0 } }"> </md-input-container> </th> <th class="text-left grade-max"> <md-input-container> <label>Points</label> <input string-to-number class="text-right" ng-blur="app.api.saveOptions()" ng-model="app.api.options.options.points_max" ng-change="grade.dataTable({variable: app.api.options.options.points_max, formula: grade.test})" min="0" type="number"> </md-input-container> </th> <th>Total<br> <span class="question-max">(max:{{grade.maxPoints}})</span> </th> <th class="score" ng-repeat="(qtitle, value) in grade.questions track by $index"> {{qtitle}}<br><span class="question-max">(max:{{value.max}})</span></th> </tr> </thead> <tbody> <tr ng-repeat="u in grade.unmatched track by $index"> <td colspan="{{grade.students.fields.length + 1}}"><md-button class="md-primary" aria-label="manual association" ng-click="grade.showAssociationDialog($event, u)">manual match</md-button></td> <td></td> <td class="text-right grade">{{grade.grade(grade.unmatched[u.key].total, app.api.options.options.points_max, 1, 6, \'round\', 0.1) | number: 2}}</td> <td class="text-right">{{grade.unmatched[u.key].total}}</td> <td class="text-right score why-{{grade.whys[grade.unmatched[u.key].key + \':\' + value.question]}}" ng-repeat="(qtitle, value) in grade.questions track by $index"> <a ng-href="#/{{grade.project}}/scan/{{grade.unmatched[u.key].student}}/{{value.page}}:{{grade.unmatched[u.key].copy}}"> {{grade.unmatched[u.key].questions[qtitle]}}</a></td> </tr> <tr ng-repeat="s in grade.students.data track by $index"> <td class="no-wrap"> <md-button aria-label="remove student" ng-click="grade.removeStudent(s)" class="md-warn button-remove"><md-icon class="mdi-close"></md-icon></md-button> <md-button ng-show="grade.scores[s.id]" aria-label="view annotated" ng-click="grade.annotateScore(grade.scores[s.id])" class="md-accent button-remove"><md-icon class="mdi-eye"></md-icon></md-button> </td> <td ng-class="{\'text-right\': col==\'id\'}" ng-repeat="col in grade.students.fields track by $index">{{s[col]}}</td> <td class="text-right grade" ng-class="{\'grade-fail\': s.FinalGrade < 3.5, \'grade-pass\': s.FinalGrade >= 4, \'grade-remed\': s.FinalGrade >=3.5 && s.FinalGrade < 4}">{{grade.calculate(s, \'FinalGrade\', app.api.options.options.final_grade_formula)}}</td> <td class="text-right grade" ng-class="{\'grade-fail\': s.Grade < 3.5, \'grade-pass\': s.Grade >= 4, \'grade-remed\': s.Grade >=3.5 && s.Grade < 4}">{{grade.scores[s.id].hasOwnProperty(\'total\') ? grade.valueSaver(s, \'Grade\', grade.grade(grade.scores[s.id].total,app.api.options.options.points_max, 1, 6, \'round\', 0.1)) : 0}}</td> <td class="text-right">{{grade.scores[s.id].total}}</td> <td class="text-right score why-{{grade.whys[grade.scores[s.id].key + \':\' + value.question]}}" ng-repeat="(qtitle, value) in grade.questions track by $index"> <a ng-href="#/{{grade.project}}/scan/{{grade.scores[s.id].student}}/{{value.page}}:{{grade.scores[s.id].copy}}"> {{grade.scores[s.id].questions[qtitle]}}</a></td> </tr> </tbody> <tfoot> <tr> <th><md-button class="md-raised md-warn" ng-click="grade.annotateAll()">Annotate All</md-button></th> <th ng-class="{\'text-right\': col==\'id\'}" ng-repeat="col in grade.students.fields track by $index"> {{grade.avgTotalStudent(col) | number: 2}} </th> <th class="text-right">{{grade.avgTotalStudent(\'FinalGrade\') | number: 2}}</th> <th class="text-right">{{grade.avgTotalStudent(\'Grade\') | number: 2}}</th> <th class="text-right">{{grade.avgTotal()}}</th> <th class="text-right score" ng-repeat="(qtitle, value) in grade.questions track by $index"> {{grade.avgQuestion(qtitle) / value.max * 100 | number: 0}}%</th> </tr> </tfoot> </table> <div class="legend"> <p><span class="why-E">E</span> means syntax error (several boxes ticked for a simple question, or " none of the above" AND another box ticked for a multiple question).</p> <p><span class="why-V">V</span> means that no box are ticked.</p> <p><span class="why-P">P</span> means that a floor has been applied.</p> </div> </section> </md-tab> <md-tab label="Stats"> <div class="section-options md-whiteframe-z1"> <md-button aria-label="sort title" class="md-primary" ng-click="grade.statsOrder=\'title\'">order by question</md-button> <md-button aria-label="sort mean" class="md-primary" ng-click="grade.statsOrder=\'avg\'">order by mean</md-button> <md-button aria-label="catalog" class="md-primary" ng-href="{{app.linkTo(\'catalog.pdf\')}}">Download Catalog.pdf</md-button> </div> <div ng-if="grade.tabIndex == 1" layout="row" layout-wrap> <div class="question-stat" ng-repeat="q in grade.stats| orderBy:grade.statsOrder"> <h2 ng-bind="q.title"></h2> <div><b>total:</b> {{q.total}} <b>mean:</b> {{(q.avg*100).toFixed(2)}}%</div> <div class="answer-dist"> <div ng-repeat="a in q.answers" ng-style="{width: a.nb/q.total*100 +\'%\'}" class="answer-stat correct-{{a.correct}}" layout="row"><span flex>{{a.answer}} {{a.nb}}</span><span>{{(a.nb/q.total*100).toFixed(2)}}%</span></div> </div> </div> </div> </md-tab> <md-tab label="{{file.name.substring(0,20)}}" ng-repeat="file in grade.files"> <md-content ng-if="grade.tabIndex == $index + 2"> <div class="section-options" layout-padding> <div layout="row" layout-sm="column"> <md-input-container flex> <label>StudentLookup</label> <input ng-model="file.studentLookup" ng-model-options="{ updateOn: \'blur\' }" ng-blur="grade.save()"> </md-input-container> <md-input-container> <label>test student id</label> <input ng-model="file.demoid" ng-blur="grade.save()"> </md-input-container> <p>{{grade.demoStudent(file)}}</p> </div> <div layout="row" layout-sm="column"> <md-input-container flex> <label>CurrentFileLookup</label> <input ng-model="file.fileLookup" ng-model-options="{ updateOn: \'blur\' }" ng-blur="grade.save()"> </md-input-container> <md-button class="md-warn" ng-click="grade.import(file)">import selected columns</md-button> </div> </div> <table> <thead> <tr> <th>Student Match</th> <th>Lookup Value</th> <th ng-repeat="key in file.meta.fields track by $index"> <div layout="row"> <md-checkbox class="md-primary" ng-model="file.meta.selected[$index]" ng-change="grade.save()">{{key}}</md-checkbox> <md-button class="button-remove" aria-label="rename column" ng-click="grade.renameColumn($event, file.meta.fields, $index, file.data)"><md-icon class="mdi-pencil"></md-icon></md-button> <md-button aria-label="remove column" ng-click="file.meta.fields.splice($index, 1);grade.save();" class="md-warn button-remove" ng-hide="col == \'id\'"><md-icon class="mdi-close"></md-icon></md-button> </div> </th> </tr> </thead> <tbody> <tr ng-repeat="row in file.data"> <td> {{ grade.lookup(row, file.fileLookup, file.studentLookup).join(\', \') }} </td> <td> {{ grade.makeFunc(file.fileLookup)(row) }} </td> <td ng-repeat="key in file.meta.fields track by $index">{{row[key]}}</td> </tr> </tbody> </table> <md-button class="md-raised md-warn" ng-click="grade.removeFile(file)">Remove file</md-button> </md-content> </md-tab> </md-tabs> </div>'),a.put("views/graphicsmanager.html",'<md-dialog aria-label="Graphics Manager" class="graphics-manager"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Graphics Manager</h2> <span flex></span> <md-button class="md-icon-button" ng-click="ctrl.closeDialog()"> <md-icon class="mdi-close" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <md-button ngf-drop ngf-select ng-model="ctrl.files" class="md-raised md-accent drop-box" ngf-drag-over-class="dragover" ngf-multiple="true" ngf-allow-dir="true"> Drop pdfs or images here or click to upload</md-button> <div ngf-no-file-drop>File Drag/Drop is not supported for this browser</div> <md-input-container> <label>Search</label> <input ng-model="ctrl.search"> </md-input-container> <div class="thumb-container" layout="row" layout-wrap ngf-drop ng-model="ctrl.files" ngf-drag-over-class="dragover" ngf-multiple="true" ngf-allow-dir="true"> <div class="graphics-preview" ng-click="ctrl.insertGraphics(item)" ng-style="{\'background-image\': ctrl.progress[item.id].progress < 100 ? \'none\' : \'url(\' + ctrl.examService.graphicsPreviewURL(item.id) + \')\'}" ng-repeat="item in ctrl.graphics | filter: {\'name\': ctrl.search} track by $index"> <div class="graphics-preview-header" layout="row" layout-align="center center"> <h3 flex>{{item.name}}</h3> <md-button ng-hide="ctrl.progress[item.id].progress < 100" class="md-icon-button md-warn" ng-click="ctrl.deleteGraphics(item); $event.stopPropagation();"> <md-icon class="mdi-delete" aria-label="delete graphics"></md-icon> </md-button> </div> <div ng-show="ctrl.progress[item.id].progress < 100"> <h4>Uploading</h4> <md-progress-linear md-mode="determinate" value="{{ctrl.progress[item.id].progress}}"></md-progress-linear> </div> </div> </div> </md-dialog-content> <div class="md-actions" layout="row"> <span flex></span> <md-button ng-click="ctrl.closeDialog()" class="md-primary"> close </md-button> </div> </md-dialog>'),a.put("views/home.html",'<md-content layout-padding class="no-background" layout-align="start center" layout="column" flex> <form ng-hide="home.isAuthed()" ng-submit="home.login()"> <md-card> <md-card-content> <md-input-container> <label>Username</label> <input ng-model="home.username" ng-required="true"> </md-input-container> <md-input-container> <label>Password</label> <input ng-model="home.password" type="password" ng-required="true"> </md-input-container> <ng-messages for="home.error" role="alert"> <ng-message when="error">{{home.error.error}}</ng-message> </ng-messages> </md-card-content> <div class="md-actions" layout="row" layout-align="end center"> <md-button class="md-primary" ng-click="home.login()">Login</md-button> <md-button ng-click="home.login()">Create</md-button> </div> </md-card> </form> <div ng-show="home.isAuthed()" class="projects"> <md-card> <md-card-content> <form ng-submit="home.createProject()" layout="row" layout-align="center center"> <md-input-container> <label>Project name</label> <input ng-model="home.newProjectName" ng-required="true"> </md-input-container> <ng-messages for="home.error" role="alert"> <ng-message when="error">{{home.error.error}}</ng-message> </ng-messages> <md-button class="md-primary md-raised">Create Project</md-button> </form> <h2>Projects</h2> <md-input-container> <label>Search</label> <input ng-model="home.search"> </md-input-container> <table ng-show="home.API.projects.length > 0"> <thead> <tr> <th colspan="2">Name</th> <th>Status</th> <th>Collaborators</th> <th class="text-right">Action</th> </tr> </thead> <tbody> <tr class="subheader" ng-show="item.short != (home.API.projects | filter: {\'project\': home.search})[$index-1].short" ng-repeat-start="item in home.API.projects | filter: {\'project\': home.search}"> <td colspan="5"> {{item.short}}</td> </tr> <tr class="project" ng-repeat-end ng-click="home.openProject(item)"> <td><md-checkbox aria-label="{{item.project}}"></md-checkbox></td> <td><b>{{item.project}}</b></td> <td> <span ng-show="item.status.printed && !item.status.annotated">printed</span> <span ng-show="item.status.annotated">annotated</span> </td> <td>{{item.users | join: \', \'}}</td> <td class="text-right"> <md-button ng-click="home.openProject(item);$event.stopPropagation();" title="open" class="md-primary md-icon-button" aria-label="copy project"><md-icon class="mdi-eye"></md-icon></md-button> <md-button ng-click="home.copyProject($event, item);$event.stopPropagation();" title="copy" class="md-primary md-icon-button" aria-label="copy project"><md-icon class="mdi-content-copy"></md-icon></md-button> </td> </tr> </tbody> </table> <md-list ng-hide="home.API.projects.length > 0"> <md-list-item>No projects found!</md-list-item> </md-list> </md-card-content> </md-card> </div> </md-content>'),a.put("views/myrichtexteditor.html",'<div class="myrichtexteditor" layout-padding> <div class="toolbar md-whiteframe-z1 hide" layout="row" layout-align="start center"> <a data-wysihtml5-command="bold" title="CTRL+B"><md-icon class="mdi-format-bold"></md-icon></a> <a data-wysihtml5-command="italic" title="CTRL+I"><md-icon class="mdi-format-italic"></md-icon></a> <a data-wysihtml5-command="formatInline" title="Monospace CTRL+M" data-wysihtml5-command-value="tt"><md-icon class="mdi-format-text"></md-icon></a> <a data-wysihtml5-command="formatInline" title="Latex Source not escaped CTRL+L" data-wysihtml5-command-value="var">LaTeX</a> <a data-wysihtml5-command="insertUnorderedList"><md-icon class="mdi-format-list-bulleted"></md-icon></a> <a data-wysihtml5-command="justifyCenter"><md-icon class="mdi-format-align-center"></md-icon></a> <a ng-mousedown="$event.preventDefault();showGraphicsManager($event)" href="javascript:;"><md-icon class="mdi-file-image-box"></md-icon></a> <a data-wysihtml5-command="insertCode" data-wysihtml5-command-value="<div class=&quot;code&quot;></div>"><md-icon class="mdi-file-xml"></md-icon></a> <a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="box" title="frame box"><md-icon class="mdi-checkbox-blank-outline"></md-icon></a> <a data-wysihtml5-action="change_view" title="toggle html source">switch view</a> </div> <textarea ng-model="content" ng-model-options="{ updateOn: \'blur\'}" class="hide"></textarea> <div class="preview"></div> <div class="graphics-toolbar hide" layout="row" ng-mousedown="$event.preventDefault()" layout-align="center center"> <md-checkbox class="md-primary" ng-mousedown="$event.preventDefault();" ng-model="graphics.border">Border</md-checkbox> <div ng-show="!graphics.options" layout="row" layout-align="center center"> <md-button aria-label="narrower" class="md-icon-button" ng-mousedown="$event.preventDefault();graphics.width=graphics.width-0.1"><md-icon class="mdi-minus"></md-icon></md-button> <p>{{graphics.width*100|number:0}}%</p> <md-button aria-label="wider" class="md-icon-button" ng-mousedown="$event.preventDefault();graphics.width=graphics.width+0.1"><md-icon class="mdi-plus"></md-icon></md-button> </div> <div class="options" ng-show="graphics.options" ng-mousedown="$event.preventDefault();showGraphicsSettings($event, graphics)"> {{graphics.options}} </div> <md-button aria-label="options" class="md-icon-button" ng-mousedown="$event.preventDefault();showGraphicsSettings($event, graphics)"><md-icon class="mdi-settings"></md-icon></md-button> <span flex></span> <md-button aria-label="close" class="md-icon-button" ng-mousedown="$event.preventDefault();closeGraphicsToolbar()"><md-icon class="mdi-close"></md-icon></md-button> </div> </div>'),a.put("views/options.html",'<div flex class="scroll-frame"> <md-content layout="column" class="no-background scroll-section options" layout-padding> <h2>Collaborators</h2> <md-chips ng-model="ctrl.options.users" placeholder="add another username" secondary-placeholder="+username"></md-chips> <h2>Raw exports</h2> <p> <md-button class="md-raised md-primary" ng-href="{{ctrl.downloadURL}}">Download project</md-button> <md-button class="md-raised md-primary" ng-href="{{ctrl.downloadODSURL}}">Download native ODS</md-button> <md-button class="md-raised md-primary" ng-href="{{ctrl.downloadCSVURL}}">Download students.csv</md-button> <md-button class="md-raised md-warn" ng-href="{{ctrl.resetLockURL}}">Reset project\'s server locks</md-button> </p> <h2>Options</h2> <p> <md-button class="md-warn md-raised" ng-click="ctrl.saveOptions()">Save Options</md-button> </p> <h3>Print</h3> <md-input-container> <label>Nb of copies</label> <input ng-model="ctrl.options.options.nombre_copies" string-to-number type="number" ng-blur="ctrl.saveOptions()"> </md-input-container> <p> <md-checkbox ng-change="ctrl.saveOptions()" class="md-primary" ng-model="ctrl.options.options.split" ng-true-value="\'1\'" ng-false-value="\'0\'">Print answersheet in separate file.</md-checkbox> </p> <h3>Scan</h3> <p> Threshold: {{ctrl.options.options.seuil * 100 | number: 0}}% black filled <md-slider ng-change="ctrl.saveOptions()" class="md-primary" md-discrete string-to-number ng-model="ctrl.options.options.seuil" min="0" max="1" step="0.05" aria-label="threshold"></md-slider> When one uses a separate answer sheet, letters or digits use at least 0.5. </p> <p> <b>Type of scans</b> <md-select ng-disabled="true" class="md-primary" placeholder="Type of scans" ng-model="ctrl.options.options.auto_capture_mode"> <md-option value="0">Different answer sheets</md-option> <md-option value="1">Some answer sheets were photocopied</md-option> </md-select> </p> <h3>Annotation</h3> <md-input-container> <label>Annotation filename pattern</label> <input ng-model="ctrl.options.options.modele_regroupement" ng-blur="ctrl.saveOptions()"> </md-input-container> <p>(N) is replaced by the student\'s name. (ID) is replaced by the student number. (<i>COL</i>) any other column in the student.csv</p> <md-input-container class="no-padding"> <label>Annotation</label> <textarea ng-model="ctrl.options.options.verdict" ng-blur="ctrl.saveOptions()"></textarea> </md-input-container> <h4>Annotation marks</h4> <table> <tr> <th>Preview</th> <th>To be ticked</th> <th>Ticked</th> <th>Type</th> <th>Color</th> </tr> <tr> <td><md-icon ng-style="{color: ctrl.options.options.symbole_0_0_color}" ng-class="{\'mdi-close\': ctrl.options.options.symbole_0_0_type == \'mark\', \'mdi-checkbox-blank-outline\': ctrl.options.options.symbole_0_0_type == \'box\', \'mdi-checkbox-blank-circle-outline\': ctrl.options.options.symbole_0_0_type == \'circle\'}"></md-icon></td> <td>no</td> <td>no</td> <td> <md-select ng-change="ctrl.saveOptions()" class="md-primary" placeholder="type" ng-model="ctrl.options.options.symbole_0_0_type"> <md-option ng-repeat="value in ::ctrl.types" value="{{value}}">{{value}}</md-option> </md-select> </td> <td><span class="color" ng-click="ctrl.options.options.symbole_0_0_color = color;ctrl.saveOptions()" ng-repeat="color in ::ctrl.colors" ng-style="{\'background-color\': color}" ng-class="{\'selected\': ctrl.options.options.symbole_0_0_color == color}"></span></td> </tr> <tr> <td><md-icon ng-style="{color: ctrl.options.options.symbole_0_1_color}" ng-class="{\'mdi-close\': ctrl.options.options.symbole_0_1_type == \'mark\', \'mdi-checkbox-blank-outline\': ctrl.options.options.symbole_0_1_type == \'box\', \'mdi-checkbox-blank-circle-outline\': ctrl.options.options.symbole_0_1_type == \'circle\'}"></md-icon></td> <td>no</td> <td>yes</td> <td> <md-select ng-change="ctrl.saveOptions()" class="md-primary" placeholder="type" ng-model="ctrl.options.options.symbole_0_1_type"> <md-option ng-repeat="value in ::ctrl.types" value="{{value}}">{{value}}</md-option> </md-select> </td> <td><span class="color" ng-click="ctrl.options.options.symbole_0_1_color = color;ctrl.saveOptions()" ng-repeat="color in ::ctrl.colors" ng-style="{\'background-color\': color}" ng-class="{\'selected\': ctrl.options.options.symbole_0_1_color == color}"></span></td> </tr> <tr> <td><md-icon ng-style="{color: ctrl.options.options.symbole_1_0_color}" ng-class="{\'mdi-close\': ctrl.options.options.symbole_1_0_type == \'mark\', \'mdi-checkbox-blank-outline\': ctrl.options.options.symbole_1_0_type == \'box\', \'mdi-checkbox-blank-circle-outline\': ctrl.options.options.symbole_1_0_type == \'circle\'}"></md-icon></td> <td>yes</td> <td>no</td> <td> <md-select ng-change="ctrl.saveOptions()" class="md-primary" placeholder="type" ng-model="ctrl.options.options.symbole_1_0_type"> <md-option ng-repeat="value in ::ctrl.types" value="{{value}}">{{value}}</md-option> </md-select> </td> <td><span class="color" ng-click="ctrl.options.options.symbole_1_0_color = color;ctrl.saveOptions()" ng-repeat="color in ::ctrl.colors" ng-style="{\'background-color\': color}" ng-class="{\'selected\': ctrl.options.options.symbole_1_0_color == color}"></span></td> </tr> <tr> <td><md-icon ng-style="{color: ctrl.options.options.symbole_1_1_color}" ng-class="{\'mdi-close\': ctrl.options.options.symbole_1_1_type == \'mark\', \'mdi-checkbox-blank-outline\': ctrl.options.options.symbole_1_1_type == \'box\', \'mdi-checkbox-blank-circle-outline\': ctrl.options.options.symbole_1_1_type == \'circle\'}"></md-icon></td> <td>yes</td> <td>yes</td> <td> <md-select ng-change="ctrl.saveOptions()" class="md-primary" placeholder="type" ng-model="ctrl.options.options.symbole_1_1_type"> <md-option ng-repeat="value in ::ctrl.types" value="{{value}}">{{value}}</md-option> </md-select> </td> <td><span class="color" ng-click="ctrl.options.options.symbole_1_1_color = color;ctrl.saveOptions()" ng-repeat="color in ::ctrl.colors" ng-style="{\'background-color\': color}" ng-class="{\'selected\': ctrl.options.options.symbole_1_1_color == color}"></span></td> </tr> </table> <md-switch ng-model="showAllOptions" aria-label="show all options"> Display all options </md-switch> <div ng-if="showAllOptions"> <md-input-container ng-repeat="(key, value) in ctrl.options.options"> <label>{{::key}}</label> <input ng-model="ctrl.options.options[key]" ng-if="::key !=\'verdict\' && key != \'email_text\'"> <textarea ng-model="ctrl.options.options[key]" ng-if="::key ==\'verdict\' || key ==\'email_text\'"></textarea> </md-input-container> </div> <p> <md-button class="md-warn md-raised" ng-click="ctrl.saveOptions()">Save Options</md-button> </p> </md-content> </div>'),a.put("views/progressdialog.html",'<md-dialog aria-label="Task Progress" class="progress-dialog" flex="60"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Task Progress</h2> </div> </md-toolbar> <md-dialog-content md-scroll-y> <div layout="row" layout-align="center center"> <md-button class="md-raised md-primary" ng-if="ctrl.api.options.status.printed && ctrl.api.logs[\'printing done\']" ng-href="{{ctrl.api.getDownloadZipURL()}}">Download Zip with all PDFs</md-button> <md-button class="md-raised md-primary" ng-if="ctrl.api.options.status.annotated && ctrl.api.logs[\'annotating done\'] && ctrl.api.logs[\'annotating done\'].type==\'all\'" ng-href="{{ctrl.api.getAnnotateZipURL()}}">Download Zip with all annotated PDFs</md-button> <md-button class="md-raised md-primary" ng-if="ctrl.api.options.status.annotated && ctrl.api.logs[\'annotating done\'] && ctrl.api.logs[\'annotating done\'].type==\'single\'" ng-href="{{ctrl.api.getStaticFileURL(ctrl.api.logs[\'annotating done\'].file)}}">Download {{ctrl.api.logs[\'annotating done\'].file}}</md-button> </div> <div ng-repeat="log in ctrl.api.sortedLogs" class="log" ng-class="{\'error\': log.code > 0}"> <h4>{{log.msg}}</h4> <md-progress-linear ng-class="{\'md-warn\': log.code > 0}" md-mode="determinate" value="{{log.progress * 100}}"></md-progress-linear> <p>{{log.start| date: \'HH:mm:ss\'}} <span ng-if="log.end">: {{(log.end.getTime() - log.start.getTime())/1000 | number: 0}}s</span></p> <pre ng-if="log.command != \'prepare\'">{{log.log}}</pre> <pre ng-if="log.command != \'prepare\' && log.code > 0">{{log.err}}</pre> </div> </md-dialog-content> <div class="md-actions" layout="row"> <span flex></span> <md-button ng-disabled="ctrl.api.options.status.locked!=0" ng-click="ctrl.closeDialog()" class="md-primary"> close </md-button> </div> </md-dialog>'),a.put("views/promptdialog.html",'<md-dialog aria-label="prompt" class="prompt-dialog"> <md-toolbar> <div class="md-toolbar-tools"> <h2 ng-bind="ctrl.options.title"></h2> <span flex></span> <md-button class="md-icon-button" ng-click="ctrl.closeDialog()"> <md-icon class="mdi-close" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> {{ctrl.options.content}} <md-input-container> <label>{{ctrl.options.label}}</label> <input ng-model="ctrl.options.value"> </md-input-container> </md-dialog-content> <div class="md-actions" layout="row"> <span flex></span> <md-button ng-click="ctrl.closeDialog()" class="md-primary"> Cancel </md-button> <md-button ng-click="ctrl.saveDialog()" class="md-primary"> Save </md-button> </div> </md-dialog>'),a.put("views/scan.html",'<div ng-if="app.api.options.options.auto_capture_mode == -1" class="printed-bar" layout-padding layout="row" layout-align="center center"> You have to choose the type of scans you use for this project: <md-select class="md-primary" placeholder="Type of scans" ng-model="scan.auto_capture_mode"> <md-option value="0">Different answer sheets</md-option> <md-option value="1">Some answer sheets were photocopied</md-option> </md-select> <md-button class="md-raised md-primary" ng-click="app.api.options.options.auto_capture_mode = scan.auto_capture_mode; app.api.saveOptions(app.api.options.options)">Save</md-button> <span flex></span> </div> <div ng-if="app.api.options.options.auto_capture_mode != -1" layout="row" flex> <div class="scan-pages" layout="column"> <div layout-padding class="scan-options"> <h4>Upload papers</h4> <p><md-button ngf-drop ngf-select ng-model="scan.files" class="md-raised md-accent drop-box" ngf-drag-over-class="dragover" ngf-multiple="true" ngf-allow-dir="true"> Drop files here or click to upload</md-button> <div ngf-no-file-drop>File Drag/Drop is not supported for this browser</div> </p> <md-content class="upload-list"> <p ng-repeat="f in scan.uploads track by $index">{{::f.name}} <md-progress-linear md-mode="determinate" value="{{f.progress}}"></md-progress-linear> </p> </md-content> <h4>Scanned papers</h4> <p>Complete: {{scan.missing.complete}} <span ng-show="scan.missing.incomplete > 0">Incomplete: {{scan.missing.incomplete}}</span></p> <div ng-show="scan.missing.missing.length > 0"> Missing pages: <md-content class="scan-missing-list"> <div ng-repeat="missing in scan.missing.missing track by $index">{{::missing.student}}/{{::missing.page}}<span ng-show="missing.copy > 0">:{{::missing.copy}}</span></div> </md-content> </div> <div ng-show="scan.missing.failed.length > 0"> Failed pages: <md-content class="scan-missing-list"> <div ng-repeat="failed in scan.missing.failed track by $index">{{::failed.filename}}</div> </md-content> </div> <md-input-container md-no-float> <md-icon class="mdi-magnify"></md-icon> <input ng-model="scan.filter" type="text" placeholder="Filter"> </md-input-container> </div> <md-content flex layout-padding md-scroll-y> <table> <thead> <tr> <th ng-class="{\'sort-asc\': scan.orderBy == \'id\' && !scan.reverse, \'sort-desc\': scan.orderBy == \'id\' && scan.reverse}" ng-click="scan.sort(\'id\')">Identifier <md-icon class="mdi-help-circle"> <md-tooltip>Student/Page/Copy green=auto blue=manual</md-tooltip></md-icon> </th> <th hide-sm ng-class="{\'sort-asc\': scan.orderBy == \'timestamp_auto\' && !scan.reverse, \'sort-desc\': scan.orderBy == \'timestamp_auto\' && scan.reverse}" ng-click="scan.sort(\'timestamp_auto\')">Updated</th> <th ng-class="{\'sort-asc\': scan.orderBy == \'mse\' && !scan.reverse, \'sort-desc\': scan.orderBy == \'mse\' && scan.reverse}" ng-click="scan.sort(\'mse\')">MSD <md-icon class="mdi-help-circle"> <md-tooltip>The value MSD (mean square deviation) is an indication of the good framing of the marks (the four black dots surrounding each copy). When it is too great, the framing must be checked.</md-tooltip></md-icon> </th> <th ng-class="{\'sort-asc\': scan.orderBy == \'s\' && !scan.reverse, \'sort-desc\': scan.orderBy == \'s\' && scan.reverse}" ng-click="scan.sort(\'s\')">Sensitivity <md-icon class="mdi-help-circle"> <md-tooltip>The value sensitivity is an indicator of proximity of the filling of the boxes with the threshold. If it is too great (from 8 to its max value 10), we must check whether the boxes recognized as checked are the good ones.</md-tooltip></md-icon> </th> </tr> </thead> <tbody> <tr ng-repeat="p in scan.pages | filter:{id:scan.filter} | orderBy: (scan.reverse?\'-\':\'\') + scan.orderBy" ng-click="scan.loadPage(p)" ng-class="{active: scan.page.student == p.student && scan.page.page == p.page && scan.page.copy == p.copy}"> <td ng-class="::{\'manual\': p.timestamp_manual > 0, \'auto\': p.timestamp_auto > 0}">{{::p.student}}/{{::p.page}}<span ng-show="::p.copy > 0">:{{::p.copy}}</span> <md-icon class="mdi-close scan-delete" ng-click="scan.delete(p)"></md-icon></td> <td hide-sm>{{::(p.timestamp_manual || p.timestamp_auto)*1000 | date:\'yyyy-MM-dd HH:mm\'}}</td> <td class="text-right" ng-class="::{\'s-threshold\': p.mse >=3}">{{::p.tm > 0 && \'(\' || \'\'}}{{::p.mse.toFixed(1)}}{{::p.tm > 0 && \')\' || \'\'}}</td> <td class="text-right" ng-class="::{\'s-threshold\': p.s >= 8}">{{::p.s.toFixed(1)}}</td> </tr> </tbody> <tfoot ng-hide="scan.pages.length > 0"> <td colspan="4"> <md-progress-linear md-mode="indeterminate"></md-progress-linear> </td> </tfoot> </table> </md-content> </div> <div ng-if="$mdMedia(\'gt-sm\')" ui-view="" class="scan-preview" flex layout="column" layout-padding hide-sm> <div flex layout="column" layout-align="center center"> <h1>No page selected for preview</h1> </div> </div> <md-sidenav ng-if="$mdMedia(\'sm\')" class="md-sidenav-right" md-component-id="right" layout="column" layout-padding> <div ui-view="" class="scan-preview" flex layout="column" layout-padding> <div flex layout="column" layout-align="center center"> <h1>No page selected for preview</h1> </div> </div> </md-sidenav> </div>'),
a.put("views/scan.preview.html",'<div style="position:relative" flex layout="row"> <md-button class="md-warn md-raised scan-reset" ng-click="preview.clear()"><md-tooltip>Remove manually set ticks</md-tooltip>remove manual</md-button> <md-checkbox class="md-primary scan-rotate" ng-model="preview.rotate">rotate</md-checkbox> <svg ng-if="preview.page" pan-zoom version="1.1" flex xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <image xlink:href="" ng-xlink:href="{{preview.pageSrc()}}" x="0" y="0" ng-attr-width="{{preview.page.width}}px" ng-attr-height="{{preview.page.height}}px" style="transform: {{preview.rotate ? \'matrix(\' + preview.page.a + \',\' + preview.page.b + \',\' + preview.page.c + \',\' + preview.page.d + \',\' + preview.page.e + \',\' + preview.page.f + \')\' : \'matrix(1,0,0,1,0,0)\'}}"></image> <g ng-attr-transform="{{ preview.rotate ? \'matrix(\' + preview.page.a + \',\' + preview.page.b + \',\' + preview.page.c + \',\' + preview.page.d + \',\' + preview.page.e + \',\' + preview.page.f + \')\' : \'\'}}"> <path ng-repeat="z in preview.zones" ng-attr-d="M {{z.x0}} {{z.y0}} L {{z.x1}} {{z.y1}} L {{z.x2}} {{z.y2}} L {{z.x3}} {{z.y3}} Z" ng-click="preview.toggle(z)" ng-attr-stroke="{{preview.ticked(z) && \'red\' || \'blue\'}}" fill="transparent" stroke-width="4" ng-attr-stroke-dasharray="{{z.manual > -1 && \'6,3\' || \'0\'}}"> </g> </svg> </div>')}]);